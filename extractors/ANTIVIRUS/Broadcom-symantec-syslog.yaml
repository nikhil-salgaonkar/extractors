schema-version: 1.0
#extractor-version: 1 #should be added in build
extractor-id: 71
source-name: SYMANTEC-ENDPOINT
source-type: ANTIVIRUS
source-description: extractor for SYMANTEC-ENDPOINT 
provides-streams:
- ENDPOINT-THREAT
master-filters:
- \w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}\s+\S+\s+SymantecServer\:\s+
event-details:
- first-match: \,CIDS\s+Signature\s+ID\:\s+\d+\,CIDS\s+Signature\s+string\:\s+
  decoder: custom
  decoder-regex: ([^\:]+)\:\s([^,]*)\,
  event-key-format: '{CIDS Signature string}'
  event-key-mapping:
    "Web Attack: JSCoinminer Download 8":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate: 
        Risk name: AtkMsg
        User: User
        Source computer: SrcHost
        Domain: Domain
        Source IP: SrcIP
    "Data Execution Protection - Execution of Non-Executable Memory":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate:
        Local: DstIP 
        Local: DstMAC
        Remote: SrcHost
        Remote: SrcIP
        Remote: SrcMAC
        User: User
        Domain: Domain
        Local Port: DstPort
        Remote Port: SrcPort
        CIDS Signature ID: EventID
        CIDS Signature string: AtkMsg
        Intrusion URL: InfectionURL  
    "Audit: Malicious Domain Request 3":   
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate: 
        Local Host IP: DstIP
        Local Host MAC: DstMAC
        Remote Host Name: SrcHost
        Remote Host IP: SrcIP
        Remote Host MAC: SrcMAC
        Application: App
        User Name: User
        Domain Name: Domain
        Local Port: DstPort
        Remote Port: SrcPort
        CIDS Signature ID: EventID
        CIDS Signature string: AtkMsg
        Intrusion URL: InfectionURL  
    "Web Attack: ZyNOS Information Disclosure":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate: 
        Event Description: AtkDesc
        Local Host IP: SrcIP
        Local Host MAC: SrcMAC
        Remote Host Name: DstHost
        Remote Host IP: DstIP
        Remote Host MAC: DstMAC
        Application: App
        User Name: User
        Domain Name: Doamin
        Local Port: DstPort
        Remote Port: SrcPort
        CIDS Signature ID: EventID
        CIDS Signature string: AtkMsg
        Intrusion URL: InfectionURL  
    "OS Attack: GNU Bash CVE-2014-6271":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate:  
        Event Description: AtkDesc
        Local Host IP: DstIP
        Local Host MAC: DstMAC
        Remote Host Name: SrcHost
        Remote Host IP: SrcIP
        Remote Host MAC: SrcMAC
        Application: App
        User Name: User
        Domain Name: Doamin  
        Local Port: DstPort
        Remote Port: SrcPort
        CIDS Signature ID: EventID
        CIDS Signature string: AtkMsg
        Intrusion URL: InfectionURL 

  fallback:
      annotate:
        EventName: Generic SYMANTEC-ENDPOINT Event
        Stream: OTHER

  globals:
    translate:
      Protocol: Proto
      SrcIP: SrcIP
      DstIP: DstIP
      SrcPort: SrcPort
      DstPort: DstPort 

- first-match: Category\s+set\:\s+.*?\,Category\s+type\:\s+
  decoder: custom
  decoder-regex: ([^\:]+)\:\s([^,]*)\,
  event-key-format: '{Category set}-{Category type}'
  event-key-mapping:
    "Malware-Heuristic Virus":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate: 
        Risk name: AtkMsg
        User: User
        Source computer: SrcHost
        Source IP: SrcIP
        Application name: App
        Domain Name: Domain
    "Malware-Virus":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECT
        Status: PASSED
      translate: 
        Risk name: AtkMsg
        User: User
        Source computer: SrcHost
        Source IP: SrcIP
        Application name: App
        Domain Name: Domain

  fallback:
      annotate:
        EventName: Generic SYMANTEC-ENDPOINT Event
        Stream: OTHER

  globals:
    translate:
      Protocol: Proto
      SrcIP: SrcIP
      DstIP: DstIP
      SrcPort: SrcPort
      DstPort: DstPort       

- first-match: Detection\s+type\:\s+
  decoder: custom
  decoder-regex: ([^\:]+)\:\s([^,]*)\,
  event-key-format: '{Detection type}'
  event-key-mapping:
    "Suspicious Behavior Detection":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: UVIRUS_DETECT
        Status: PASSED
      translate: 
        IP Address: DstIP
        Detection type: AtkDesc
        Application name: App
        Download site: URL
        Risk name: AtkMsg
        Domain: Domain
        User: User
        Source computer: SrcHost

  fallback:
      annotate:
        EventName: Generic SYMANTEC-ENDPOINT Event
        Stream: OTHER

  globals:
    translate:
      Protocol: Proto
      SrcIP: SrcIP
      DstIP: DstIP
      SrcPort: SrcPort
      DstPort: DstPort       
