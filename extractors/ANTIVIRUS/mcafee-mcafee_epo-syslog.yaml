schema-version: 1.0
#extractor-version: 1
extractor-id: 77
source-name: MCAFEE-EPO
source-type: ANTIVIRUS
source-description: Extractor for McAfee Antivirus Events
provides-streams:
- AUTHENTICATION
- ENDPOINT-THREAT
master-filters:
- \'?AnalyzerName\'?\:\s+\'?(?:VirusScan\s+Enterprise|McAfee\s+Endpoint\s+Security|Data\s+Loss\s+Prevention|McAfee\s+System\s+Prep\s+Tool|Endpoint\s+Security\s+Platform|McAfee\s+Host\s+Intrusion\s+Prevention|Solidifier|VirusScan\s+Enterprise\s+for\s+Linux)\'?\,?
- \{DBLogForwarderError\:\s+OperationalError\(\(.*?severity\s+\d+
- \'AutoId\'\:\s+\d+\,\s+\'UserId\'\:\s+\d+\,\s+\'UserName\'\:\s+\'.*?\'\,\s+\'Priority\'\:\s+\d+\,\s+\'CmdName\'\:\s+\'.*?\'\,
event-details:
- first-match: \'?ThreatEventID\'?\:\s+\d+\,
  decoder: custom
  decoder-regex: \'?([\w]+)\'?\:\s+\'?([^\,\']+)
  event-key-format: '{ThreatEventID}'
  event-key-mapping:
    '1024':
      annotate:
        Stream: ENDPOINT-THREAT
        Action: THREAT_DETECTED
        Status: PASSED
      translate:
        TargetFileName: FileName
        TargetIPV4: DstIP
        TargetUserName: User
        SourceIPV4: SrcIP
        ThreatSeverity: Severity
        ThreatName: AtkMsg
    '34865':
      annotate:
        Stream: ENDPOINT-THREAT
        Action: THREAT_BLOCKED
        Status: PASSED
      translate:
        TargetFileName: FileName
        TargetIPV4: DstIP
        TargetUserName: User
        SourceIPV4: SrcIP
        ThreatSeverity: Severity
        ThreatName: AtkMsg
    '1102':  
      annotate:
        Stream: ENDPOINT-THREAT
        Action: THREAT_QUARANTINE
        Status: PASSED
      translate:
        TargetFileName: FileName
        TargetIPV4: DstIP
        TargetUserName: User
        SourceIPV4: SrcIP
        ThreatSeverity: Severity
        ThreatName: AtkMsg
    '18055':
      annotate:
        Stream: ENDPOINT-THREAT
        Action: THREAT_DETECTED
        Status: PASSED
      translate:
        TargetFileName: FileName
        TargetIPV4: DstIP
        TargetUserName: User
        SourceIPV4: SrcIP
        ThreatSeverity: Severity
        ThreatName: AtkMsg


  fallback:
    annotate:
      EventName: Generic McAfee Antivirus Event
      Stream: OTHER

  globals:
    translate:
      ReceivedUTC: SystemTstamp
      TargetHostName: System

  subs: &id001
    Severity:
      '1': ALERT
      '2': CRITICAL
      '3': ERROR
      '4': WARNING
      '5': NOTICE
      '6': INFORMATION    

- first-match: \'AutoId\'\:\s+\d+\,\s+\'UserId\'\:\s+\d+\,\s+\'UserName\'\:\s+\'.*?\'\,\s+\'Priority\'\:\s+\d+\,\s+\'CmdName\'\:\s+
  decoder: custom
  decoder-regex: \'?([\w]+)\'?\:\s+\'?([^\,\']+)
  event-key-format: '{CmdName}-{Success}'
  event-key-mapping:
    'Logon Attempt-True':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
        AuthMethod: '-'
        Reason: '-'
      translate:
        UserName: User                                               
        LocalAddress: SrcIP        
    'User Log Off-True':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
        AuthMethod: '-'
      translate:
        UserName: User                                              
        LocalAddress: SrcIP
    'Logon Attempt-False':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        AuthMethod: '-'
        Reason: INVALID_PASSWORD
      translate:
        UserName: User                                               
        LocalAddress: SrcIP

  fallback:
    annotate:
      EventName: Generic McAfee Antivirus Event
      Stream: OTHER

  globals:
    translate:
      StartTime: SystemTstamp  
      TargetHostName: System      

  subs: *id001