schema-version: 1.0
#extractor-version: 1
extractor-id: 67
source-name: CISCO
source-type: OS
source-description: Extractor for Cisco OS Events
provides-streams:
- AUTHENTICATION
- ROUTER
- SWITCH
master-filters:
- '\s+\%(?:ETHPORT|AUTHPRIV|LINEPROTO-SW2|LINK-SW2|SEC|FMANFP|PORT_SECURITY|DOT1X|PORT|SEC_LOGIN|SYS|SSH|VSHD|LINK|LINEPROTO)\-\d+\-(?:IF_UP|IF_DOWN_LINK_FAILURE|SYSTEM_MSG|UPDOWN|IPACCESSLOGS|IPACCESSLOGP|PACK_SND_FAIL|IPACCESSLOGDP|LOGIN_SUCCESS|LOGOUT|LOGIN_FAILED|IPACCESSLOGNP|PSECURE_VIOLATION|FAIL)\:\s+'
event-details:
- first-match: '\%SSH\-3\-PACK\_SND\_FAIL'
  decoder: regex
  decoder-regex: '(?P<datetime>\w+\s+\d+\s+\d+\:\d+\:\d+).*?\s+\%(?P<facility>\S+)\-(?P<severity>\d+)\-(?P<hostname>.*?)\:\s+(?P<action>.*)'
  event-key-format: '{hostname}'
  event-key-mapping:
    PACK_SND_FAIL:
      annotate:
        Stream: ROUTER
        Action: PACKET_SEND
        Status: FAILED
      translate:
        message: Message
        severity: Severity

  fallback:
    annotate:
      EventName: Generic Cisco OS Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: '\%SEC\_LOGIN\-'
  decoder: regex
  decoder-regex: '(?P<datetime>\w+\s+\d+\s+\d+\:\d+\:\d+).*?\s+\%(?P<facility>\S+)\-(?P<severity>\d+)\-(?P<hostname>.*?)\:\s+(?P<action>.*?)\s+\[user\:\s+(?P<user>.*?)\]\s+\[Source\:\s+(?P<src>[\d\.]+)\]\s+\[localport\:\s+(?P<sport>\d+)\]\s+'
  event-key-format: '{action}'
  event-key-mapping:
    Login Success:
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
        AuthMethod: '-'
        Reason: '-'
      translate:
        src: SrcIP
        user: User
    Login failed:
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
        AuthMethod: '-'
        Reason: INVALID_PASSWORD
      translate:
        src: SrcIP
        user: User

  fallback:
    annotate:
      EventName: Generic Cisco OS Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: '\%SYS\-6\-LOGOUT\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w+\s+\d+\s+\d+\:\d+\:\d+).*?\s+\%(?P<facility>\w+)\-(?P<severity>\d+)\-(?P<hostname>\w+)\:\s+(?P<message>User\s+(?P<user>[\w\.\-]+)\s+.*?\((?P<src>[\d\.]+)\))'
  event-key-format: '{hostname}'
  event-key-mapping:
    LOGOUT:
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
        AuthMethod: '-'
      translate:
        src: SrcIP
        user: User

  fallback:
    annotate:
      EventName: Generic Cisco OS Event
      Stream: OTHER
      
  globals:
    translate:
      datetime: SystemTstamp
      hostname: System


- first-match: '\%AUTHPRIV\-3\-SYSTEM\_MSG\:'
  decoder: regex
  decoder-regex: '(?P<Pdatetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}).*?\s+\%(?P<facility>\S+)\-(?P<severity>\d+)\-(?P<hostname>.*?)\:\s+.*?\:(?P<msg>(?P<action>Authentication\s+failed)\s+from\s+(?P<src>.*?)\s+.*?(?P<daemon>\S+)\[(?P<pid>\d+)\])'
  event-key-format: '{action}'
  event-key-mapping:
    'Authentication failed':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        AuthMethod: '-'
        Reason: INVALID_PASSWORD
        User: '-'
      translate:
        src: SrcIP

  fallback:
    annotate:
      EventName: Generic Cisco OS Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

      
- first-match: '\%DOT1X\-5\-FAIL\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}).*?\%(?P<facility>\S+)\-(?P<severity>\d+)\-(?P<hostname>\S+)\:\s+(?P<message>(?P<action>Authentication\s+failed).*?Interface\s+(?P<iface>\S+)\s+.*)'
  event-key-format: '{action}'
  event-key-mapping:
    'Authentication failed':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        AuthMethod: SSH
        Reason: Reason
        User: '-'
      translate:
        src: SrcIP

  fallback:
    annotate:
      EventName: Generic Cisco OS Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System
       
- first-match: '\%PORT\_SECURITY\-2\-PSECURE\_VIOLATION\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}).*?\%(?P<facility>\w+)\-(?P<severity>\d+)\-(?P<hostname>\S+)\:\s+(?P<message>(?P<evtdesc>.*?)\,.*?address\s+(?P<mac_address>[\w\.]+)\s+.*?\.)(?:\s+\((?P<hostname>.*?)\))?'
  event-key-format: ''
  event-key-mapping:
    '':
      annotate:
        Stream: SWITCH
        Action: SECURITY_VIOLATION
        Status: PASSED
      translate:
        message: Message
        evtdesc: EvtDesc
        mac_address: MACAddress
        severity: Severity

  fallback:
    annotate:
      EventName: Generic Cisco OS Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System