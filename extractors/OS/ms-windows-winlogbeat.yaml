schema-version: 1.0
#extractor-version: 1
extractor-id: 710
integration: winlogbeat(OSS)
vendor-name: Microsoft
product-name: Windows
source-name: WINDOWS
source-type: OS
source-description: Extractor for Windows Winlogbeat Events
provides-streams:
- SYSMON-PROCESS
- SYSMON-NETWORK
- SYSMON-FILE
- SYSMON-IMAGE-LOAD
- SYSMON-REGISTRY
- SYSMON-WMI
- SYSMON-PIPE
- SYSMON-SERVICE
- SYSMON-DNS
- IAM
- AUTHENTICATION
master-filters:
- \"beat\"\:\"winlogbeat\"
event-details:
- first-match: \"Microsoft\-Windows\-Sysmon/Operational\"
  decoder: json
  event-key-format: '{winlog[event_id]}'
  event-key-mapping:
    '1':
      annotate:
        Stream: SYSMON-PROCESS
        Action: PROCESS_ADDED
        Status: PASSED
      translate:
        winlog[event_data][User]: User
        winlog[event_data][ParentCommandLine]: ParentCommandLine
        winlog[event_data][ParentImage]: ParentImage
        winlog[event_data][Image]: Image
        winlog[event_data][CommandLine]: CommandLine
        winlog[event_data][Description]: Description
        winlog[event_data][Company]: Company
        winlog[event_data][Product]: Product

    '2':
      annotate:
        Stream: SYSMON-PROCESS
        Action: PROCESS_FILE_TIME_CHANGED
        Status: PASSED
      translate:
        winlog[event_data][Image]: Image

    '3':
      annotate:
        Stream: SYSMON-NETWORK
        Action: NETWORK_CONNECTION
        Status: PASSED
      translate:
        winlog[event_data][Image]: Image
        winlog[event_data][SourceIp]: SrcIP
        winlog[event_data][SourcePort]: SrcPort
        winlog[event_data][SourceHostname]: SrcHost
        winlog[event_data][DestinationIp]: DstIP
        winlog[event_data][DestinationHostname]: DstHost
        winlog[event_data][DestinationPort]: DstPort
        winlog[event_data][Description]: Description

    '4':
      annotate:
        Stream: SYSMON-SERVICE
        Action: SERVICE_STARTED
        Status: PASSED
      translate:
        winlog[event_data][SchemaVersion]: SchemaVersion
        winlog[event_data][State]: State 

    '5':
      annotate:
        Stream: SYSMON-PROCESS
        Action: PROCESS_REMOVED
        Status: PASSED
      translate:
        winlog[event_data][User]: User
        winlog[event_data][ParentCommandLine]: ParentCommandLine
        winlog[event_data][ParentImage]: ParentImage
        winlog[event_data][Image]: Image
        winlog[event_data][CommandLine]: CommandLine
        winlog[event_data][Description]: Description
        winlog[event_data][Company]: Company
        winlog[event_data][Product]: Product

    '6':
      annotate:
        Stream: SYSMON-DRIVER-LOAD
        Action: DRIVER_LOADED
        Status: PASSED
      translate:
        winlog[event_data][User]: User

    '7':
      annotate:
        Stream: SYSMON-IMAGE-LOAD
        Action: PROCESS_ACCESSED
        Status: PASSED
      translate:
        winlog[event_data][User]: User
        winlog[event_data][Description]: Description
        winlog[event_data][Company]: Company
        winlog[event_data][Product]: Product

    '8':
      annotate:
        Stream: SYSMON-PROCESS
        Action: CREATE_REMOTE_THREAD
        Status: PASSED
      translate:
        winlog[event_data][TargetImage]: TargetImage
        winlog[event_data][Description]: Description

    '10':
      annotate:
        Stream: SYSMON-PROCESS
        Action: PROCESS_ACCESSED
        Status: PASSED
      translate:
        winlog[event_data][TargetImage]: TargetImage
        winlog[event_data][CallTrace]: CallTrace
        winlog[event_data][GrantedAccess]: GrantedAccess
        winlog[event_data][Description]: Description

    '11':
      annotate:
        Stream: SYSMON-FILE
        Action: FILE_CREATED
        Status: PASSED
      translate:
        winlog[event_data][Image]: Image
        winlog[event_data][TargetFilename]: TargetFilename
        winlog[event_data][CreationUtcTime]: CreationUtcTime

    '12':
      annotate:
        Stream: SYSMON-REGISTRY
        Status: PASSED
      translate:
        winlog[event_data][EventType]: Action
        winlog[event_data][Image]: Image
        winlog[event_data][TargetObject]: TargetObject
        winlog[event_data][Description]: Description

    '13':
      annotate:
        Stream: SYSMON-REGISTRY
        Status: PASSED
      translate:
        winlog[event_data][EventType]: Action
        winlog[event_data][Image]: Image
        winlog[event_data][TargetObject]: TargetObject
        winlog[event_data][Details]: Details
        winlog[event_data][Description]: Description

    '15':
      annotate:
        Stream: SYSMON-FILE
        Action: FILE_CREATED_STREAM_HASH
        Status: PASSED
      translate:
        winlog[event_data][Image]: Image
        winlog[event_data][TargetFilename]: TargetFilename
        winlog[event_data][CreationUtcTime]: CreationUtcTime

    '16':
      annotate:
        Stream: SYSMON-CONFIG
        Action: STATE_CHANGED
        Status: PASSED
      translate:
        winlog[event_data][Configuration]: Configuration
        winlog[event_data][ConfigurationFileHash]: ConfigurationFileHash

    '17':
      annotate:
        Stream: SYSMON-PIPE
        Action: PIPE_CREATED
        Status: PASSED
      translate:
        winlog[event_data][PipeName]: PipeName
        winlog[event_data][Image]: Image 

    '18':
      annotate:
        Stream: SYSMON-PIPE
        Action: PIPE_CONNECTED
        Status: PASSED
      translate:
        winlog[event_data][PipeName]: PipeName
        winlog[event_data][Image]: Image 

    '19':
      annotate:
        Stream: SYSMON-WMI
        Action: FILTER_ACTIVITY
        Status: DETECTED
      translate:
        winlog[event_data][EventType]: Action
        winlog[event_data][Name]: Name
        winlog[event_data][Operation]: Operation
        winlog[event_data][User]: User

    '20':
      annotate:
        Stream: SYSMON-WMI
        Action: CONSUMER_ACTIVITY
        Status: DETECTED
      translate:
        winlog[event_data][User]: User
        winlog[event_data][Name]: Name
        winlog[event_data][Type]: Type
        winlog[event_data][Destination]: Destination

    '21':
      annotate:
        Stream: SYSMON-WMI
        Action: CONSUMER_TO_FILTER_ACTIVITY
        Status: DETECTED
      translate:
        winlog[event_data][User]: User
        winlog[event_data][Operation]: Operation
        winlog[event_data][Consumer]: Consumer
        winlog[event_data][Filter]: Filter

    '22':
      annotate:
        Stream: SYSMON-DNS
        Action: DNS_QUERY
        Status: PASSED
      translate:
        winlog[event_data][QueryName]: QueryName
        winlog[event_data][QueryStatus]: QueryStatus
        winlog[event_data][QueryResults]: QueryResults
        winlog[event_data][Image]: Image

    '23':
      annotate:
        Stream: SYSMON-FILE
        Action: FILE_DELETED
        Status: DETECTED
      translate:
        winlog[event_data][Image]: Image
        winlog[event_data][TargetFilename]: TargetFilename
        winlog[event_data][User]: User

  fallback:
    annotate:
      EventName: Generic WinlogBeat Event
      Stream: OTHER

  globals:
    translate:
      winlog[computer_name]: System
      winlog[event_data][UtcTime]: SystemTstamp

  subs:
    Action:
      'SetValue': OBJECT_MODIFIED
      'DeleteValue': OBJECT_MODIFIED
      'CreateKey': OBJECT_CREATED
      'DeleteKey': OBJECT_DELETED
      'SERVICE_STARTED': SERVICE_STARTED
      'PROCESS_ADDED': PROCESS_ADDED
      'DRIVER_LOADED': DRIVER_LOADED
      'STATE_CHANGED': STATE_CHANGED
      'PIPE_CREATED': PIPE_CREATED
      'DNS_QUERY': DNS_QUERY
      'FILE_DELETED': FILE_DELETED
      'PIPE_CONNECTED': PIPE_CONNECTED
      'CREATE_REMOTE_THREAD': CREATE_REMOTE_THREAD
      'NETWORK_CONNECTION': NETWORK_CONNECTION
      'PROCESS_REMOVED': PROCESS_REMOVED
      'PROCESS_ACCESSED': PROCESS_ACCESSED
      'FILE_CREATED': FILE_CREATED
      'CONSUMER_ACTIVITY': CONSUMER_ACTIVITY
      'FILE_CREATED_STREAM_HASH': FILE_CREATED_STREAM_HASH
      'PROCESS_FILE_TIME_CHANGED': PROCESS_FILE_TIME_CHANGED
      'CONSUMER_TO_FILTER_ACTIVITY': CONSUMER_TO_FILTER_ACTIVITY

- first-match: \"Microsoft\-Windows\-Eventlog\"
  decoder: json
  event-key-format: '{winlog[event_id]}'
  event-key-mapping:
    '1102':
      annotate:
        Stream: IAM
        Action: AUDIT_LOG_CLEARED
        Status: PASSED
      translate:
        winlog[user_data][SubjectUserName]: User

  fallback:
    annotate:
      EventName: Generic WinlogBeat Event
      Stream: OTHER

  globals:
    translate:
      winlog[computer_name]: System
      '@timestamp': SystemTstamp

- first-match: \"Microsoft\-Windows\-Security\-Auditing\"
  decoder: json
  event-key-format: '{winlog[event_id]}'
  event-key-mapping:
    '4662':
      annotate:
        Stream: IAM
        Action: AUDIT_LOG_CLEARED
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User
    '5136':
      annotate:
        Stream: IAM
        Action: OBJECT_MODIFIED
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User
    '4732':
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_MEMBER_ADDED
        Status: PASSED
      translate:
        winlog[event_data][TargetUserName]: TargetUser
        winlog[event_data][SubjectUserName]: User
    '4742':
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_CHANGED
        Status: PASSED
      translate:
        winlog[event_data][TargetUserName]: TargetUser
        winlog[event_data][SubjectUserName]: User
    '5145':
      annotate:
        Stream: IAM
        Action: NET_SHR_ACCESS_CHK
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User 
    '4724':
      annotate:
        Stream: IAM
        Action: ACCOUNT_PASSWORD_RESET
        Status: PASSED
      translate:
        winlog[event_data][TargetUserName]: TargetUser
        winlog[event_data][SubjectUserName]: User
    '4738':
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CHANGED
        Status: PASSED
      translate:
        winlog[event_data][TargetUserName]: TargetUser
        winlog[event_data][SubjectUserName]: User  
    '4768':
      annotate:
        Stream: AUTHENTICATION
        Action: KRBTGT_REQ_ISSUED
        Status: PASSED
      translate:
        winlog[event_data][TargetUserName]: User
    '4771':
      annotate:
        Stream: AUTHENTICATION
        Action: KRB_PREAUTH_ERR
        Status: FAILED
      translate:
        winlog[event_data][TargetUserName]: User
    '4776':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
      translate:
        winlog[event_data][TargetUserName]: User    
    '5140':
      annotate:
        Stream: IAM
        Action: OBJECT_ACCESSED
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User 
    '5142':
      annotate:
        Stream: IAM
        Action: OBJECT_ADDED
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User 
    '4611':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User 
    '4624':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User 
        winlog[event_data][IpAddress]: SrcIP
    '4625':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
      translate:
        winlog[event_data][SubjectUserName]: User
        winlog[event_data][IpAddress]: SrcIP
    '4634':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        winlog[event_data][TargetUserName]: User
    '4648':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User 
        winlog[event_data][IpAddress]: SrcIP 
    '4663':
      annotate:
        Stream: IAM
        Action: OBJECT_ACCESSED
        Status: PASSED
      translate:
        winlog[event_data][SubjectUserName]: User  
    '4672':          
      annotate:
        Stream: IAM
        Action: PRIVILEGE_SET
        Status: PASSED    
      translate:  
        winlog[event_data][SubjectUserName]: User
    '4720':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CREATED
        Status: PASSED    
      translate: 
        winlog[event_data][SubjectUserName]: User 
        winlog[event_data][TargetUserName]: TargetUser                                          

  fallback:
    annotate:
      EventName: Generic WinlogBeat Event
      Stream: OTHER

  globals:
    translate:
      winlog[computer_name]: System
      '@timestamp': SystemTstamp            
      
- first-match: \"MSSQLSERVER\"
  decoder: json
  event-key-format: '{winlog[event_id]}'
  event-key-mapping:
    '18456':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
      translate:
        winlog[host][name]: User
    '18454':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        winlog[host][name]: User

  fallback:
    annotate:
      EventName: Generic WinlogBeat Event
      Stream: OTHER

  globals:
    translate:
      winlog[computer_name]: System
      '@timestamp': SystemTstamp