schema-version: 1.0
#extractor-version: 1 
extractor-id: 128
source-name: WINDOWS
source-type: OS
source-description: Extractor for Windows Events
provides-streams:
- AUTHENTICATION
- SYSMON-PROCESS
- SYSMON-NETWORK
- SYSMON-IMAGE-LOAD
- IAM
master-filters:
- \"SourceName\"\:\s*\"Microsoft\-Windows
event-details:  
- first-match: \"SourceName\"\:\s*\"Microsoft-Windows-Security-Auditing\"
  decoder: json
  event-key-format: '{EventID}'         
  event-key-mapping:
    '4720':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CREATED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain 
    '4625': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        AuthMethod: '-'
        Reason: INVALID_PASSWORD
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
    '4624':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED  
        AuthMethod: '-'
        Reason: '-'  
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
    '4634':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED   
        AuthMethod: '-'
      translate:
        TargetUserName: User
    '4647':
      annotate:
        Stream: AUTHENTICATION 
        Action: LOGOUT
        Status: PASSED   
        AuthMethod: '-'
      translate:
        TargetUserName: User
        IpAddress: SrcIP
    '4648':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
        AuthMethod: '-'
        Reason: '-'    
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
    '4776':         
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED 
        AuthMethod: '-'
        Reason: '-'   
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
    '4778':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED   
        AuthMethod: '-'
        Reason: '-'
      translate:
        ClientAddress: SrcIP
        AccountName: User
    '4741':         
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_CREATED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain  
    '4722':          
      annotate:
        Stream: IAM
        Action: ACCOUNT_ENABLED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4723':         
      annotate:
        Stream: IAM
        Action: ACCOUNT_PASSWORD_CHANGED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4724':         
      annotate:
        Stream: IAM
        Action: ACCOUNT_PASSWORD_RESET
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4725':         
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_DISABLED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4726':         
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_DELETED
        Status: PASSED    
      translate:
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain 
    '4738':            
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CHANGED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4740':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_LOCKOUT
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain 
    '4767':          
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_UNLOCKED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4742':            
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_CHANGED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4743':           
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_DELETED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4731':         
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_CREATED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
        SubjectDomainName: Domain 
    '4732':         
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_MEMBER_ADDED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
        SubjectDomainName: Domain
    '4733':         
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_MEMBER_REMOVED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
        SubjectDomainName: Domain
    '4756':         
      annotate:
        Stream: IAM
        Action: SECURITY_UGRP_MEMBER_ADDED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        SubjectDomainName: Domain
        TargetUserName: TargetUser
        TargetDomainName: TargetDomain
    '4672':          
      annotate:
        Stream: IAM
        Action: PRIVILEGE_SET
        Status: PASSED    
      translate:  
        SubjectUserName: User
        SubjectDomainName: Domain     
    '4779':          
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
        AuthMethod: '-'
      translate:
        IpAddress: SrcIP
        AccountName: User
    '4670':          
      annotate:
        Stream: IAM
        Action: PRIVILEGE_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        SubjectDomainName: Domain 
    '4674': 
      annotate:
        Stream: IAM
        Action: PRIVILEGE_OBJECT_ACCESS
        Status: PASSED    
      translate:  
        SubjectUserName: User
        SubjectDomainName: Domain 
    '5140':    
      annotate:
        Stream: IAM
        Action: NETWORK_SHARE_ACCESSED
        Status: PASSED    
      translate:  
        IpAddress: SrcIP
        IpPort: SrcPort
        SubjectUserName: User
        SubjectDomainName: Domain  

  fallback:
    annotate:
      EventName: Generic Windows Event
      Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: System

- first-match: \"SourceName\"\:\s*\"Microsoft\-Windows\-Sysmon\"
  decoder: json
  event-key-format: '{EventID}'
  event-key-mapping:
    '1': 
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_ADDED
        Status: PASSED
      translate:
        User: User
        ParentCommandLine: ParentCommandLine
        OriginalFileName: OriginalFileName
        ParentImage: ParentImage 
        Image: Image
        CommandLine: CommandLine
        Description: Description
        Company: Company
        Product: Product
    '5': 
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_REMOVED
        Status: PASSED
      translate:
        Image: Image
        User: User
        Description: Description

    '3': 
      annotate:
        Stream: SYSMON-NETWORK 
        Action: NETWORK_CONNECTION
        Status: PASSED
      translate:
        Image: Image
        SourceIp: SrcIP
        SourcePort: SrcPort
        SourceHostname: SrcHost
        DestinationIp: DstIP
        DestinationHostname: DstHost
        DestinationPort: DstPort
        Description: Description

    '10':
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_ACCESSED
        Status: PASSED
      translate:
        SourceImage: SourceImage
        TargetImage: TargetImage
        GrantedAccess: GrantedAccess
        CallTrace: CallTrace
        Description: Description

    '8':
      annotate:
        Stream: SYSMON-PROCESS
        Action: CREATE_REMOTE_THREAD
        Status: PASSED
      translate:
        SourceImage: SourceImage
        TargetImage: TargetImage
        Description: Description
        StartAddress: StartAddress
        StartModule: StartModule
        StartFunction: StartFunction

    '7':
      annotate:
        Stream: SYSMON-IMAGE-LOAD 
        Action: PROCESS_ACCESSED
        Status: PASSED
      translate:
        User: User
        Description: Description
        Company: Company
        Product: Product   
             
  fallback:
    annotate:
      EventName: Generic Windows Event
      Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: System