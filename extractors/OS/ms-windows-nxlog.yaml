schema-version: 1.0
#extractor-version: 1 
extractor-id: 128
integration: syslog
vendor-name: Microsoft
product-name: Windows
source-name: WINDOWS
source-type: OS
source-description: Extractor for Windows Events
provides-streams:
- AUTHENTICATION
- SYSMON-PROCESS
- SYSMON-NETWORK
- SYSMON-FILE
- SYSMON-REGISTRY
- SYSMON-IMAGE-LOAD
- CONFIGURATION
- THREAT
- IAM
master-filters:
- \"SourceName\"\:\"(?:Microsoft\-Windows|Security|Userenv|KDC|ADWS|OIMPasswordSync|ADSync|Cisco\s+Systems\,\s+Inc\.\s+ICM|MsiInstaller|Desktop\s+Window\s+Manager|Ntfs|VMware\s+Repository|volsnap|User32|Service\s+Control\s+Manager|Windows\s+Error\s+Reporting|HealthService|PowerShell|Microsoft\-Office\s+Server\-Search|EventLog|Group\s+Policy\s+Shortcuts|Microsoft\-Exchange\-HighAvailability|Group\s+Policy\s+Registry|MSExchange\s+CmdletLogs|Symantec\s+Network\s+Protection|Networker|disk|DRS\s+Auditing|Disk|Microsoft\-Exchange\-ActiveMonitoring|EMET|igfxCUIService2.0.0.0|Puppet|DOM|FinTxn|Flexcube\s+DataSelect|QLManagementAgentJava|Finware|Branch|Xmit|crypt32|McLogEvent|Directory\s+Synchronization|Schannel|WebSphere\s+MQ\s+\(Installation1\)|SecurityCenter|Application\s+Error|vmStatsProvider|LANDESK\s+Inventory\s+Server|LANDesk\s+Abstraction\s+Layer|ESENT|gupdate|WebsenseSyncService\@\d+\.\d+\.\d+\.\d+|Health\s+Service\s+Script|Server\s+Administrator|Group\s+Policy\s+Local\s+Users\s+and\s+Groups|Group\s+Policy\s+Services|\.NET\s+Runtime|Internet\s+Explorer|Application\s+Popup|Symantec\s+Endpoint\s+Protection|WGate|Symantec\s+AntiVirus|AzureDiagnostics|FinSMSService|Connect\s+Direct\s+v4\.7\.0|BrnService|PortNoxSvc|MariaDB|\.NET\s+app\s+monitoring|VMUpgradeHelper|VMTools|Apm\s+Scripting|ASP\.NET\s+4\.0\.30319\.0|Application\s+Hang|BlackShield|Microsoft\-Exchange\-ManagedAvailability|MSExchangeRepl|Microsoft\-WindowsAzurePack\-MgmtSvc\-AdminAPI|Microsoft\-SharePoint\s+Products\-SharePoint\s+Foundation|SMS\s+Server|Hyperion\s+Financial\s+Management|MSExchangeTransport|MSExchangeTransportSubmission|nssm|MSExchangeFrontEndTransport|MSExchangeTransportDelivery|SAPRP2\_20|ASP\.NET\s+2\.0\.50727\.0|Microsoft\s+Office\s+14\s+Alerts|MSExchange\s+Assistants|VisualSVN\s+Server\s+3\.6|LS\s+Master\s+Replicator\s+Agent\s+Service|LS\s+User\s+Replicator|Microsoft\-SharePoint\s+Products\-SharePoint\s+Server\s+Search|MSExchange\s+Mid\-Tier\s+Storage|LS\s+Replica\s+Replicator\s+Agent\s+Service|MSExchange\s+OWA|QvWebServer|Veeam\s+MP|LS\s+Storage\s+Service|Microsoft\.SystemCenter\.VirtualMachineManager\.2012\.Report\.VPortUsageCollection|Microsoft\.SystemCenter\.VirtualMachineManager\.PRO|CordysLogger\s+BOP4|Citrix\-XenDesktop\-BrokerMonitor|Flexcube\s+Download|FinAppTxn|ContentStore|Microsoft\-Filtering\-FIPFS|LS\s+Web\s+Components\s+Server|QlikViewServer|MSExchangeIS\s+Mailbox\s+Store|InputAccel|MSExchangeMailboxAssistants|MSExchangeADTopology|CyberArk\s+PSMWin|.NET\s+Runtime\s+Optimization\s+Service|IIS\s+AspNetCore Module|Group\s+Policy\s+Drive\s+Maps|Microsoft\s+Office\s+16\s+Alerts|Active\s+Server\s+Pages|ADSync|Removable\s+Storage\s+Service|NTBackup|edgeupdate|Group\s+Policy\s+Files|Print|IBM\s+MQ\s+\(Installation1\)|Microsoft\-Client\-Licensing\-Platform|Health\s+Service\s+Modules|CAARCserveRHAEngine|NETLOGON|NtFrs|Virtual\s+Disk\s+Service|VSS|VSSAudit|SceCli|OCS\s+Inventory\s+Service|CloudEndureVolumeUpdater|NTDS\s+ISAM|LsaSrv|Service\s+Connector|OpsMgr\s+Connector|Health\s+Service\s+ESE\s+Store|Windows\s+Server\s+Update\s+Services|Discovery\s+Service|NetBackup\s+Legacy\s+Client\s+Service|VontuUpdate|VxPBX\s+Service|Microsoft\-Exchange\-ESE|MSExchange\s+ADAccess|CitrixCseEngine|Microsoft\-SharePoint\s+Products\-Excel\s+Services\s+Application|redis|Lfsvc|vmci|ServerView\s+Agents|ServerView\s+Server\s+Control|ServerView\s+Remote\s+Connector|System\.ServiceModel\s+4\.0\.0\.0|nginx|NTDS\s+Replication|NTDS\s+General|BROWSER|NTDS\s+Database)
event-details:  
- first-match: \"SourceName\"\:\s*\"Microsoft-Windows-Security-Auditing\"
  decoder: json
  event-key-format: '{EventID}'         
  event-key-mapping:
    '4720':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CREATED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4625': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
        SubStatus: Reason
    '4624':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '4634':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        TargetUserName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '4647':
      annotate:
        Stream: AUTHENTICATION 
        Action: LOGOUT
        Status: PASSED
      translate:
        TargetUserName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '4648':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED   
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '4776':         
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED   
      translate: 
        TargetUserName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '4778':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        ClientAddress: SrcIP
        AccountName: User
        AuthenticationPackageName: AuthProto
    '4741':         
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_CREATED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4722':          
      annotate:
        Stream: IAM
        Action: ACCOUNT_ENABLED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4723':         
      annotate:
        Stream: IAM
        Action: ACCOUNT_PASSWORD_CHANGED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4724':         
      annotate:
        Stream: IAM
        Action: ACCOUNT_PASSWORD_RESET
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4725':         
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_DISABLED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4726':         
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_DELETED
        Status: PASSED    
      translate:
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4738':            
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CHANGED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4740':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_LOCKOUT
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4767':          
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_UNLOCKED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4742':            
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_CHANGED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4743':           
      annotate:
        Stream: IAM
        Action: SYSTEM_USER_ACCOUNT_DELETED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4731':         
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_CREATED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4732':         
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_MEMBER_ADDED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4733':         
      annotate:
        Stream: IAM
        Action: SECURITY_LGRP_MEMBER_REMOVED
        Status: PASSED    
      translate: 
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4756':         
      annotate:
        Stream: IAM
        Action: SECURITY_UGRP_MEMBER_ADDED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4672':          
      annotate:
        Stream: IAM
        Action: PRIVILEGE_SET
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role 
    '4779':          
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        IpAddress: SrcIP
        AccountName: User
        AuthenticationPackageName: AuthProto
    '4670':          
      annotate:
        Stream: IAM
        Action: PRIVILEGE_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User
        TargetUserName: TargetUser
        Role: Role
    '4674': 
      annotate:
        Stream: IAM
        Action: PRIVILEGE_OBJECT_ACCESS
        Status: PASSED    
      translate:  
        SubjectUserName: User 
        TargetUserName: TargetUser
        Role: Role
    '5140':    
      annotate:
        Stream: IAM
        Action: NETWORK_SHARE_ACCESSED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role
    '4739':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        Config: Config
    '4782':
      annotate:
        Stream: IAM
        Action: PASSWORD_HASH_ACCESSED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role
    '4727':
      annotate:
        Stream: IAM
        Action: SECURITY_GLOBAL_GROUP_CREATED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role
    '4728':
      annotate:
        Stream: IAM
        Action: SECURITY_GLOBAL_GROUP_MEMBER_ADDED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role 
    '4729':
      annotate:
        Stream: IAM
        Action: SECURITY_GLOBAL_GROUP_MEMBER_REMOVED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role   
    '4730':
      annotate:
        Stream: IAM
        Action: SECURITY_GLOBAL_GROUP_DELETED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
    '4731':
      annotate:
        Stream: IAM
        Action: SECURITY_LOCAL_GROUP_CREATED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser    
        Role: Role 
    '4732':
      annotate:
        Stream: IAM
        Action: SECURITY_LOCAL_GROUP_MEMBER_ADDED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role 
    '4733':
      annotate:
        Stream: IAM
        Action: SECURITY_LOCAL_GROUP_MEMBER_REMOVED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role   
    '4734':
      annotate:
        Stream: IAM
        Action: SECURITY_LOCAL_GROUP_DELETED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
    '4735':
      annotate:
        Stream: IAM
        Action: SECURITY_LOCAL_GROUP_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser    
        Role: Role 
    '4737':
      annotate:
        Stream: IAM
        Action: SECURITY_GLOBAL_GROUP_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role 
    '4754':
      annotate:
        Stream: IAM
        Action: SECURITY_UNIVERSAL_GROUP_CREATED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role   
    '4755':
      annotate:
        Stream: IAM
        Action: SECURITY_UNIVERSAL_GROUP_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser   
    '4756':
      annotate:
        Stream: IAM
        Action: SECURITY_UNIVERSAL_GROUP_MEMBER_ADDED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role 
    '4757':
      annotate:
        Stream: IAM
        Action: SECURITY_UNIVERSAL_GROUP_MEMBER_REMOVED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role   
    '4758':
      annotate:
        Stream: IAM
        Action: SECURITY_UNIVERSAL_GROUP_DELETED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser         
    '4781':
      annotate:
        Stream: IAM
        Action: ACCOUNT_NAME_CHANGED
        Status: PASSED    
      translate:  
        SubjectUserName: User  
        TargetUserName: TargetUser
        Role: Role 
    '4649':
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED   
        Vector: NETWORK
        Threat: A replay attack was detected. 
      translate:  
        SubjectUserName: User  
        SrcIP: SrcIP
        DstIP: DstIP                               

  fallback:
    annotate:
      EventName: Generic Windows Event
      Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: System

  subs:
    Reason: 
      '0x0': 'SUCCESS'
      '0xc000005e': 'SRVC_UNAVAIL'
      '0xc0000064': 'BAD_USER'
      '0xc000006a': 'BAD_PASS'
      '0xc000006d': 'SYS_CREDS'
      '0xc000006e': 'BAD_USER_PASS'
      '0xc000006f': 'OUT_OFF_HRS'
      '0xc0000070': 'WRNG_WKSTN'
      '0xc0000071': 'PASS_EXPIRD'
      '0xC0000072': 'USR_DISBLD'
      '0xc00000dc': 'SAM_STAT'
      '0xc0000133': 'TIME_SYC_ERR'
      '0xc000015b': 'BAD_POL'
      '0xc000018c': 'DOMAIN_TRUST_FAIL'
      '0xc0000192': 'SRVC_UNAVAIL'
      '0xc0000193': 'AC_EXPIRD'
      '0xc0000199': 'WKSTN_TRUST_FAIL'
      '0xc0000224': 'CHNG_PASS'
      '0xc0000225': 'BUG'
      '0xc0000234': 'USR_LKOUT'
      '0xc00002ee': 'ERR'
      '0xc0000413': 'LOGIN_FAIL_FW_POL'


- first-match: \"SourceName\"\:\s*\"Microsoft\-Windows\-Sysmon\"
  decoder: json
  event-key-format: '{EventID}'
  event-key-mapping:
    '1': 
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_ADDED
        Status: PASSED
      translate:
        User: User
        ParentCommandLine: ParentCommandLine
        OriginalFileName: OriginalFileName
        ParentImage: ParentImage 
        Image: Image
        CommandLine: CommandLine
        Description: Description
        Company: Company
        Product: Product
    '5': 
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_REMOVED
        Status: PASSED
      translate:
        Image: Image
        User: User
        Description: Description

    '3': 
      annotate:
        Stream: SYSMON-NETWORK 
        Action: NETWORK_CONNECTION
        Status: PASSED
      translate:
        Image: Image
        SourceIp: SrcIP
        SourcePort: SrcPort
        SourceHostname: SrcHost
        DestinationIp: DstIP
        DestinationHostname: DstHost
        DestinationPort: DstPort
        Description: Description

    '10':
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_ACCESSED
        Status: PASSED
      translate:
        TargetImage: TargetImage
        GrantedAccess: GrantedAccess
        CallTrace: CallTrace
        Description: Description

    '11':
      annotate:
        Stream: SYSMON-FILE
        Action: FILE_CREATED
        Status: PASSED
      translate:
        Image: Image
        TargetFilename: TargetFilename
        CreationUtcTime: CreationUtcTime    
    
    '12':
      annotate:
        Stream: SYSMON-REGISTRY 
        Action: OBJECT_MODIFIED
        Status: PASSED
      translate:
        Image: Image
        TargetObject: TargetObject
        Description: Description 

    '13':
      annotate:
        Stream: SYSMON-REGISTRY 
        Action: OBJECT_MODIFIED
        Status: PASSED
      translate:
        Image: Image
        TargetObject: TargetObject
        Details: Details
        Description: Description    

    '8':
      annotate:
        Stream: SYSMON-PROCESS
        Action: CREATE_REMOTE_THREAD
        Status: PASSED
      translate:
        TargetImage: TargetImage
        Description: Description

    '7':
      annotate:
        Stream: SYSMON-IMAGE-LOAD 
        Action: PROCESS_ACCESSED
        Status: PASSED
      translate:
        User: User
        Description: Description
        Company: Company
        Product: Product   
             
  fallback:
    annotate:
      EventName: Generic Windows Event
      Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: System

- first-match: \"SourceName\"\:\"Security\"
  decoder: json
  event-key-format: '{EventID}'
  event-key-mapping:
    '528': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '552': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '538': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '551': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '540': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '680': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '682': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
    '683': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
      translate: 
        AccountName: User
        IpAddress: SrcIP
        AuthenticationPackageName: AuthProto
        SubStatus: Reason             
    '576': 
      annotate:
        Stream: IAM
        Action: PRIVILEGE_SET
        Status: PASSED
      translate: 
        AccountName: User
        TargetUser: TargetUser
        Role: Role
    '644':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_LOCKOUT
        Status: PASSED    
      translate:  
        AccountName: User
        TargetUser: TargetUser
        Role: Role 
    '624':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CREATED
        Status: PASSED    
      translate:  
        AccountName: User
        TargetUser: TargetUser
        Role: Role        
    '646':           
      annotate:
        Stream: IAM
        Action: USER_ACCOUNT_CHANGED
        Status: PASSED    
      translate:  
        AccountName: User
        TargetUser: TargetUser
        Role: Role            

  fallback:
    annotate:
      EventName: Generic Windows Event
      Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: System        