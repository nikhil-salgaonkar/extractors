schema-version: 1.0
#extractor-version: 1 #should be added in build
extractor-id: 128
source-name: WINDOWS-NXLOG-AUDIT
source-type: OS
source-description: Extractor for Windows Events
provides-streams:
- AUTHENTICATION
- SYSMON-PROCESS
- SYSMON-NETWORK
- IAM
master-filters:
- \"SourceName\"\:\"Microsoft\-Windows
event-details:  
- first-match: \"SourceName\"\:\"Microsoft-Windows-Security-Auditing\"
  decoder: json
  event-key-format: '{EventID}'         
  event-key-mapping:
    '4720':           
      annotate:
        Action: USER_ACCOUNT_CREATED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain 
    '4625': 
      annotate:
        Action: LOGIN
        Status: FAILED
        Stream: AUTHENTICATION
      translate: 
        TargetUserName: User
        TargetDomainName: TargetDomain
        WorkstationName: SrcHost
        IpAddress: SrcIP
        IpPort: SrcPort
    '4624':
      annotate:
        Action: LOGIN
        Status: PASSED    
        Stream: AUTHENTICATION
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
        WorkstationName: SrcHost
        IpAddress: SrcIP
        IpPort: SrcPort  
    '4634':
      annotate:
        Action: LOGOUT
        Status: PASSED    
        Stream: AUTHENTICATION
      translate:   
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4647': 
      annotate:
        Action: LOGOUT
        Status: PASSED    
        Stream: AUTHENTICATION 
      translate: 
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4648':          
      annotate:
        Action: LOGIN
        Status: PASSED    
        Stream: AUTHENTICATION
      translate: 
        TargetUserName: User
        TargetDomainName: TargetDomain
        IpAddress: SrcIP
        IpPort: SrcPort
    '4776':         
      annotate:
        Action: LOGIN
        Status: PASSED    
        Stream: AUTHENTICATION
      translate: 
        Workstation: SrcHost
        TargetUserName: User
    '4778':         
      annotate:
        Action: LOGIN_SESSION_RECONNECTED
        Status: PASSED    
        Stream: AUTHENTICATION
      translate:  
        AccountDomain: TargetDomain
        ClientName: SrcHost
        ClientAddress: SrcIP
    '4741':         
      annotate:
        Action: SYSTEM_USER_ACCOUNT_CREATED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain  
    '4722':          
      annotate:
        Action: ACCOUNT_ENABLED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4723':         
      annotate:
        Action: ACCOUNT_PASSWORD_CHANGED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4724':         
      annotate:
        Action: ACCOUNT_PASSWORD_RESET
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4725':         
      annotate:
        Action: USER_ACCOUNT_DISABLED
        Status: PASSED    
        Stream: IAM
      translate:  
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4726':         
      annotate:
        Action: USER_ACCOUNT_DELETED
        Status: PASSED    
        Stream: IAM
      translate:
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain 
    '4738':            
      annotate:
        Action: USER_ACCOUNT_CHANGED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4740':           
      annotate:
        Action: USER_ACCOUNT_LOCKOUT
        Status: PASSED    
        Stream: IAM
      translate:  
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain 
    '4767':          
      annotate:
        Action: USER_ACCOUNT_UNLOCKED
        Status: PASSED    
        Stream: IAM
      translate:  
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4742':            
      annotate:
        Action: SYSTEM_USER_ACCOUNT_CHANGED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4743':           
      annotate:
        Action: SYSTEM_USER_ACCOUNT_DELETED
        Status: PASSED    
        Stream: IAM
      translate:  
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
    '4731':         
      annotate:
        Action: SECURITY_LGRP_CREATED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
        SubjectDomainName: Domain 
    '4732':         
      annotate:
        Action: SECURITY_LGRP_MEMBER_ADDED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
        SubjectDomainName: Domain
    '4733':         
      annotate:
        Action: SECURITY_LGRP_MEMBER_REMOVED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        TargetUserName: User
        TargetDomainName: TargetDomain
        SubjectDomainName: Domain
    '4756':         
      annotate:
        Action: SECURITY_UGRP_MEMBER_ADDED
        Status: PASSED    
        Stream: IAM
      translate:  
        SubjectUserName: AdminUser
        SubjectDomainName: Domain
    '5140':         
      annotate:
        Action: NETWORK_SHARE_ACCESSED
        Status: PASSED    
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        SubjectDomainName: Domain 
        IpPort: SrcPort
        IpAddress: SrcIP
    '5145':         
      annotate:
        Action: NETWORK_SHARE_ACCESS_CHECKED
        Status: PASSED
        Stream: IAM
      translate: 
        SubjectUserName: AdminUser
        SubjectDomainName: Domain 
        IpPort: SrcPort
        IpAddress: SrcIP
    '4674':          
      annotate:
        Action: PRIVILEGE_OBJECT_ACCESS
        Status: PASSED
        Stream: IAM
      translate:   
        SubjectUserName: AdminUser
        SubjectDomainName: Domain
    '4672':          
      annotate:
        Action: PRIVILEGE_SET
        Status: PASSED    
        Stream: IAM
      translate:  
        SubjectUserName: AdminUser
        SubjectDomainName: Domain     
    '4779':          
      annotate:
        Action: LOGIN_SESSION_DISCONNECT
        Status: PASSED
        Stream: AUTHENTICATION
      translate:   
        SubjectUserName: AdminUser
        SubjectDomainName: Domain  

  fallback:
      annotate:
        EventName: Generic Windows Event
        Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: SystemName 
      Severity: LogLevel 
      EventID: EventID         

- first-match: \"SourceName\"\:\"Microsoft\-Windows\-Sysmon\"
  decoder: json
  event-key-format: '{EventID}'
  event-key-mapping:
    '1': 
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_ADDED
        Status: PASSED
      translate:
        Description: EvtDesc
        User: DomainUser
        ParentCommandLine: ParentProcess
        ParentProcessId: PPID
    '5': 
      annotate:
        Stream: SYSMON-PROCESS 
        Action: PROCESS_REMOVED
        Status: PASSED
      translate:
        Image: FilePath 
        ParentCommandLine: ParentProcess
        ParentProcessId: PPID   
    '3': 
      annotate:
        Stream: SYSMON-NETWORK 
        Action: NETWORK_CONNECTION
        Status: PASSED
      translate:
        Image: FilePath 
        ParentCommandLine: ParentProcess
        ParentProcessId: PPID    
        SourceIp: SrcIP
        SourcePort: SrcPort
        SourceHostname: SrcHost
        DestinationIp: DstIP
        DestinationHostname: DstHost
        DestinationPort: DstPort          

  fallback:
      annotate:
        EventName: Generic Windows Events
        Stream: OTHER

  globals:
    translate:
      EventTime: SystemTstamp
      Hostname: SystemName 
      Severity: LogLevel 
      EventID: EventID  
      
