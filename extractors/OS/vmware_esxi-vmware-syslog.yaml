schema-version: 1.0
#extractor-version: 1
extractor-id: 98
source-name: VMWARE
source-type: OS
source-description: Extractor for VMWARE OS Events
provides-streams:
- AUTHENTICATION
master-filters:
- '^(?:<\d+>\d*)?\s*\d{4}\-\d+\-\d+T\d+\:\d+\:\d+[\.\w\+\:]+\s+[\.\w\-]+\s+(?:smbiosDump|Hostd|vmkernel|Vpxa|vobd|lwsmd|Rhttpproxy|hostd\-probe|storageRM|cimslp|smartd|heartbeat|sdrsInjector|vmkwarning|vsantraced|vmon|vpxd|vmcad|vmdird|Fdm|localcli|root|backup\.sh\.\d+|vmauthd|sfcb-vmware_raw|slpd)'
event-details:
- first-match: 'Event\s+\d+\s+\:\s+User[\s\w\.\@\:]+logged\s+out\s+'
  decoder: regex
  decoder-regex: '(?P<datetime>\d+\-\d+\-\d+T\d+\:\d+\:\d+)\.\w+\s+(?P<hostname>\S+)\s+(?P<daemon>\S+)\:\s+(?P<severity>\w+)\s+(?P<appserverice>\w+).*?(?:user=|User)\s+(?P<user>.*?)\@.*?(?P<action>logged\s+out)\s+'
  event-key-format: '{action}'
  event-key-mapping:
    'logged out':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        user: User
        src: SrcIP
        reason: Reason
        AuthProto: AuthProto
  fallback:
    annotate:
      EventName: Generic VMWARE OS Event
      Stream: OTHER
  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'Event\s+\d+\s+\:\s+User[\s\w\.\@\:]+logged\s+in\s+'
  decoder: regex
  decoder-regex: '(?P<datetime>\d+\-\d+\-\d+T\d+\:\d+\:\d+)\.\w+\s+(?P<hostname>.*?)\s+(?P<daemon>.*?)\:\s(?:\[\w+\s)?(?P<severity>\w+)\s+(?:(\w+)\[)?.*?(?:user\=|User)\s+(?P<user>.*?)\@(?P<src>[\d\.]+)\s+(?P<action>logged\s+in).*'
  event-key-format: '{action}'
  event-key-mapping:
    'logged in':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        user: User
        src: SrcIP
        reason: Reason
        AuthProto: AuthProto
  fallback:
    annotate:
      EventName: Generic VMWARE OS Event
      Stream: OTHER
  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'Authentication\s+for\s+user.*?failed'
  decoder: regex
  decoder-regex: '(?P<datetime>\d+\-\d+\-\d+T\d+\:\d+\:\d+).*?\s+(?P<hostname>.*?)\s+(?P<daemon>\w+)\:.*?\:(?P<message>.*?user\s+(?P<user>\w+)\@.*)'
  event-key-format: ''
  event-key-mapping:
    '':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_PASSWORD
      translate:
        user: User
        src: SrcIP
        AuthProto: AuthProto
  fallback:
    annotate:
      EventName: Generic VMWARE OS Event
      Stream: OTHER
  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'vpxd.*logged\s+(?:in|out)'
  decoder: regex
  decoder-regex: '(?P<datetime>\d+\-\d+\-\d+T\d+\:\d+\:\d+)\..*?\s+(?P<hostname>\S+)\s+(?P<daemon>vpxd)\s+\S+\s+\S+\s+\S+\s+.*?\[(?P<severity>info)\]\s+\[.*?\]\s+\[.*?\]\s+\[\d+\]\s+\[(?P<message>User\s+(?P<user>.*?)\@.*?(?P<action>logged\s+(?:in|out)).*)\]'
  event-key-format: '{action}'
  event-key-mapping:
    'logged in':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        user: User
        src: SrcIP
        reason: Reason
        AuthProto: AuthProto
    'logged out':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        user: User
        src: SrcIP
        reason: Reason
        AuthProto: AuthProto    
  fallback:
    annotate:
      EventName: Generic VMWARE OS Event
      Stream: OTHER
  globals:
    translate:
      datetime: SystemTstamp
      hostname: System