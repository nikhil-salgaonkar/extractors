schema-version: 1.0
#extractor-version: 1
extractor-id: 715
integration: Auditbeat
vendor-name: Linux
product-name: ALL
source-name: AUDITBEAT
source-type: OS
source-description: Extractor for Auditbeat Events
provides-streams:
- AUTHENTICATION
- CONFIGURATION
- AUDITD
- IAM
master-filters:
- '\"type\"\:\"auditbeat\"'
event-details:
- first-match: '(?:\"category\":\[\"authentication\"\].*?\"action\":\"(?:logged\-in|was\-authorized|changed\-login\-id\-to|authenticated|user\_login|acquired\-credentials|disposed\-credentials|refreshed\-credentials|started\-session|ended\-session)|\"action\":\"(?:logged\-in|was\-authorized|changed\-login\-id\-to|authenticated|user\_login|acquired\-credentials|disposed\-credentials|refreshed\-credentials|started\-session|ended\-session).*?\"category\":\[\"authentication\"\])'
  decoder: json
  event-key-format: '{event[action]}-{event[outcome]}'
  event-key-mapping:
    'logged-in-success':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto
    'logged-in-failure':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto
    'was-authorized-success':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        related[user][0]: User
        host[ip][0]: SrcIP
        AuthProto: AuthProto
    'was-authorized-failure':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        related[user][0]: User
        host[ip][0]: SrcIP
        AuthProto: AuthProto
    'changed-login-id-to-success':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        related[user][0]: User
        host[ip][0]: SrcIP
        AuthProto: AuthProto
    'changed-login-id-to-failure':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        related[user][0]: User
        host[ip][0]: SrcIP
        AuthProto: AuthProto
    'authenticated-success':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto
    'authenticated-failure':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto 
    'user_login-success':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto
    'user_login-failure':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto 
    'acquired-credentials-success':
      annotate:
        Stream: AUDITD
        Action: CREDENTIALS_ACQUIRED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine 
    'acquired-credentials-failure':
      annotate:
        Stream: AUDITD
        Action: CREDENTIALS_ACQUIRED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine 
    'disposed-credentials-success':
      annotate:
        Stream: AUDITD
        Action: CREDENTIALS_DISPOSED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs 
        auditd[data][cmd]: CommandLine 
    'disposed-credentials-failure':
      annotate:
        Stream: AUDITD
        Action: CREDENTIALS_DISPOSED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs 
        auditd[data][cmd]: CommandLine 
    'refreshed-credentials-success':
      annotate:
        Stream: AUDITD
        Action: CREDENTIALS_REFRESHED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs  
        auditd[data][cmd]: CommandLine 
    'refreshed-credentials-failure':
      annotate:
        Stream: AUDITD
        Action: CREDENTIALS_REFRESHED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs  
        auditd[data][cmd]: CommandLine 
    'started-session-success':
      annotate:
        Stream: AUDITD
        Action: SESSION_STARTED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs   
        auditd[data][cmd]: CommandLine 
    'started-session-failure':
      annotate:
        Stream: AUDITD
        Action: SESSION_STARTED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs   
        auditd[data][cmd]: CommandLine 
    'ended-session-success':
      annotate:
        Stream: AUDITD
        Action: SESSION_ENDED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs   
        auditd[data][cmd]: CommandLine  
    'ended-session-failure':
      annotate:
        Stream: AUDITD
        Action: SESSION_ENDED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs   
        auditd[data][cmd]: CommandLine  

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '(?:\"category\":\[\"authentication\"\].*?\"action\"\:\"user\_logout\"|\"action\"\:\"user\_logout\".*?\"category\":\[\"authentication\"\])'
  decoder: json
  event-key-format: '{event[action]}'
  event-key-mapping:
    'user_logout':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        user[name]: User
        source[ip]: SrcIP
        AuthProto: AuthProto 

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '\"category\":\[\"file\"'
  decoder: json
  event-key-format: '{event[type][0]}'
  event-key-mapping:
    'creation':
      annotate:
        Stream: AUDITD
        Action: FILE_CREATED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'deletion':
      annotate:
        Stream: AUDITD
        Action: FILE_DELETED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'change':
      annotate:
        Stream: AUDITD
        Action: FILE_MODIFIED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'info':
      annotate:
        Stream: AUDITD
        Action: FILE_INFO
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '(?:\"category\":\[\"process\"\].*?\"action\"\:\"(?:started\-service|stopped\-service|ran\-command|executed)|\"action\"\:\"(?:started\-service|stopped\-service|ran\-command|executed).*?\"category\":\[\"process\"\])'
  decoder: json
  event-key-format: '{event[action]}-{event[outcome]}'
  event-key-mapping:
    'started-service-success':
      annotate:
        Stream: AUDITD
        Action: SERVICE_STARTED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'started-service-failure':
      annotate:
        Stream: AUDITD
        Action: SERVICE_STARTED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'stopped-service-success':
      annotate:
        Stream: AUDITD
        Action: SERVICE_STOPPED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'stopped-service-failure':
      annotate:
        Stream: AUDITD
        Action: SERVICE_STOPPED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'executed-success':
      annotate:
        Stream: AUDITD
        Action: PROCESS_ADDED
        Status: PASSED
      translate:
        user[name]: User
        process[working_directory]: Process
        process[args]: ProcessArgs 
        auditd[data][cmd]: CommandLine 
    'executed-failure':
      annotate:
        Stream: AUDITD
        Action: PROCESS_ADDED
        Status: FAILED
      translate:
        user[name]: User
        process[working_directory]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'ran-command-success':
      annotate:
        Stream: AUDITD
        Action: USER_COMMAND_EXECUTED
        Status: PASSED
      translate:
        user[name]: User
        process[working_directory]: Process
        process[args]: ProcessArgs  
        auditd[data][cmd]: CommandLine
    'ran-command-failure':
      annotate:
        Stream: AUDITD
        Action: USER_COMMAND_EXECUTED
        Status: FAILED
      translate:
        user[name]: User
        process[working_directory]: Process
        process[args]: ProcessArgs  
        auditd[data][cmd]: CommandLine

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '(?:\"category\":\[\"process\"\].*?\"action\"\:\"(?:existing\_process|process\_error|process\_started|process\_stopped)|\"action\"\:\"(?:existing\_process|process\_error|process\_started|process\_stopped).*?\"category\":\[\"process\"\])'
  decoder: json
  event-key-format: '{event[action]}'
  event-key-mapping:
    'process_started':
      annotate:
        Stream: AUDITD
        Action: PROCESS_STARTED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'process_stopped':
      annotate:
        Stream: AUDITD
        Action: PROCESS_STOPPED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'process_error':
      annotate:
        Stream: AUDITD
        Action: PROCESS_ERRORED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'existing_process':
      annotate:
        Stream: AUDITD
        Action: PROCESS_ADDED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    
  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '\"category\":\[\"network\"\]'
  decoder: json
  event-key-format: '{event[action]}-{event[outcome]}'
  event-key-mapping:
    'connected-to-success':
      annotate:
        Stream: AUDITD
        Action: CONNECTED_TO
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'connected-to-failure':
      annotate:
        Stream: AUDITD
        Action: CONNECTED_TO
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'accepted-connection-from-success':
      annotate:
        Stream: AUDITD
        Action: CONNECTION_ACCEPTED
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'accepted-connection-from-failure':
      annotate:
        Stream: AUDITD
        Action: CONNECTION_ACCEPTED
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'bound-socket-success':
      annotate:
        Stream: AUDITD
        Action: BOUND_SOCKET
        Status: PASSED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'bound-socket-failure':
      annotate:
        Stream: AUDITD
        Action: BOUND_SOCKET
        Status: FAILED
      translate:
        user[name]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'changed-promiscuous-mode-on-device-success':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: Changed Promiscuous Mode On Device
      translate:
        user[name]: User
    'changed-promiscuous-mode-on-device-failure':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: FAILED
        Config: Changed Promiscuous Mode On Device
      translate:
        user[name]: User
    
  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '\"category\":\[\"session\"\]'
  decoder: json
  event-key-format: '{event[action]}-{event[outcome]}'
  event-key-mapping:
    'ended-session-success':
      annotate:
        Stream: AUDITD
        Action: SESSION_ENDED
        Status: PASSED
      translate:
        related[user][0]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'ended-session-failure':
      annotate:
        Stream: AUDITD
        Action: SESSION_ENDED
        Status: FAILED
      translate:
        related[user][0]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'started-session-success':
      annotate:
        Stream: AUDITD
        Action: SESSION_STARTED
        Status: PASSED
      translate:
        related[user][0]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    'started-session-failure':
      annotate:
        Stream: AUDITD
        Action: SESSION_STARTED
        Status: FAILED
      translate:
        related[user][0]: User
        process[executable]: Process
        process[args]: ProcessArgs
        auditd[data][cmd]: CommandLine
    
  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '\"category\":\[\"iam\"\]'
  decoder: json
  event-key-format: '{event[action]}'
  event-key-mapping:
    'existing_user':
      annotate:
        Stream: IAM
        Action: PASSWORD_DISABLED
        Status: PASSED
      translate:
        host[name]: User
        user[name]: TargetUser
        Role: Role

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '\"category\":\[\"host\"\]'
  decoder: json
  event-key-format: '{event[action]}'
  event-key-mapping:
    'boot':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: System Boot
      translate:
        user[name]: User

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp

- first-match: '\"category\":\[\"configuration\"\,\"process\"]'
  decoder: json
  event-key-format: '{event[action]}-{event[outcome]}'
  event-key-mapping:
    'loaded-firewall-rule-to-success':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: Firewall Rule Loaded
      translate:
        user[name]: User
    'loaded-firewall-rule-to-failure':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: FAILED
        Config: Firewall Rule Loaded
      translate:
        user[name]: User

  fallback:
    annotate:
      EventName: Generic Auditbeat Event
      Stream: OTHER

  globals:
    translate:
      host[hostname]: System
      '@timestamp': SystemTstamp