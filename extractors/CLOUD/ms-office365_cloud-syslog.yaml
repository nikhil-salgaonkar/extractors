schema-version: 1.0
#extractor-version: 1
extractor-id: 231
source-name: MS-O365
source-type: CLOUD
source-description: Extractor for Microsoft Office 365 Events
provides-streams:
- EMAIL-GATEWAY
- AUTHENTICATION
- IAM
master-filters:
- \{\"CreationTime\"\:\"\d{4}\-\d{1,2}\-\d{2}T\d{2}\:\d{2}\:\d{2}\".*?OrganizationId\"\:\"\S+\"\,.*?\"UserType\"\:\d+\,
event-details:
- first-match: \"UserType\"\:\d+\,
  decoder: custom
  decoder-regex: '\"([^\"]+)\"\:\"?\[?([^\"]+|[^\,]+)'
  event-key-format: '{Operation}'
  event-key-mapping:
    'Set-Mailbox':
      annotate:
        Stream: EMAIL-GATEWAY
        Action: EMAIL_ACCEPTED
      translate:
        From: Sender
        To: Recipient
        Subject: Subject
        Attachments: File
        Directionality: Direction
        ClientIP: RemoteIP
    'Create':
      annotate:
        Stream: EMAIL-GATEWAY
        Action: EMAIL_ACCEPTED
      translate:
        From: Sender
        To: Recipient
        Subject: Subject
        Attachments: File
        Directionality: Direction
        ClientIPAddress: RemoteIP
    'Update':
      annotate:
        Stream: EMAIL-GATEWAY
        Action: EMAIL_ACCEPTED
      translate:
        From: Sender
        To: Recipient
        Subject: Subject
        Attachments: File
        Directionality: Direction
        ClientIP: RemoteIP 
    'Move':
      annotate:
        Stream: EMAIL-GATEWAY
        Action: EMAIL_ACCEPTED
      translate:
        From: Sender
        To: Recipient
        Subject: Subject
        Attachments: File
        Directionality: Direction
        ClientIP: RemoteIP            
    'DlpRuleMatch':
      annotate:
        Stream: EMAIL-GATEWAY
        Action: EMAIL_ACCEPTED
      translate:
        From: Sender
        To: Recipient
        Subject: Subject
        Attachments: File
        Directionality: Direction
        ClientIP: RemoteIP
    'UserLoggedIn':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        protocol: AuthProto
        ClientIP: SrcIP
        UserId: User
    'UserLoginFailed':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
      translate:
        protocol: AuthProto
        LogonError: Reason
        ClientIP: SrcIP 
        UserId: User   
    'Update user.':
      annotate:
        Stream: IAM
        Action: USER_UPDATED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'Delete user.':
      annotate:
        Stream: IAM
        Action: USER_DELETED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser        
    'Change user license.':
      annotate:
        Stream: IAM
        Action: USER_LICENSE_CHANGED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'Disable account.':
      annotate:
        Stream: IAM
        Action: ACCOUNT_DISABLED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'Change user password.':
      annotate:
        Stream: IAM
        Action: USER_PASSWORD_CHANGED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'Reset user password.':
      annotate:
        Stream: IAM
        Action: ACCOUNT_PASSWORD_RESET
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser  
    'Remove member from group.':
      annotate:
        Stream: IAM
        Action: GROUP_MEMBER_REMOVED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'Add member to group.':
      annotate:
        Stream: IAM
        Action: GROUP_MEMBER_ADDED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'MemberRemoved':
      annotate:
        Stream: IAM
        Action: MEMBER_REMOVED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser
    'MemberAdded':
      annotate:
        Stream: IAM
        Action: MEMBER_ADDED
        Status: PASSED
      translate:
        UserId: User
        Role: Role
        TargetUser: TargetUser                                        
    
  fallback:
    annotate:
      EventName: Generic Microsoft Office 365 Event
      Stream: OTHER

  globals:
    annotate:
      System: MS-O365
    translate:
      CreationTime: SystemTstamp