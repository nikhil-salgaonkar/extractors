schema-version: 1.0
#extractor-version: 1
extractor-id: 700
integration: AWS S3
vendor-name: AWS
product-name: AWS Cloudtrail
source-name: AWS
source-type: CLOUD
source-description: Extractor for AWS Events
provides-streams:
- CLOUDTRAIL
master-filters:
- \"awsRegion\"
event-details:
- first-match: \"eventType\":\s*\"AwsApiCall\"
  decoder: json
  event-key-format: '{userIdentity[type]}'
  event-key-mapping:
    'AWSService':
      annotate:
        Stream: CLOUDTRAIL
        User: '[AWSService]'
      translate:
        eventType: EventType
        eventSource: EventSource
        eventName: EventName
        eventTime: SystemTstamp
        awsRegion: AwsRegion
        userIdentity[type]: UserGroup
        userAgent: UserAgent
        requestParameters: RequestParameters
        responseElements: ResponseElements
        errorCode: ErrorCode

    'IAMUser':
      annotate:
        Stream: CLOUDTRAIL
      translate:
        eventType: EventType
        eventSource: EventSource
        eventName: EventName
        eventTime: SystemTstamp
        awsRegion: AwsRegion
        userIdentity[userName]: User
        userIdentity[accessKeyId]: AccessKey
        userIdentity[arn]: UserArn
        userIdentity[type]: UserGroup
        sourceIPAddress: SrcIP
        userAgent: UserAgent
        requestParameters: RequestParameters
        responseElements: ResponseElements
        errorCode: ErrorCode


    'Root':
      annotate:
        Stream: CLOUDTRAIL
        User: '[Root]'
      translate:
        eventType: EventType
        eventSource: EventSource
        eventName: EventName
        eventTime: SystemTstamp
        awsRegion: AwsRegion
        userIdentity[accessKeyId]: AccessKey
        userIdentity[type]: UserGroup
        sourceIPAddress: SrcIP
        userAgent: UserAgent
        requestParameters: RequestParameters
        responseElements: ResponseElements
        errorCode: ErrorCode

  fallback:
    annotate:
      EventName: Generic AWS Events
      Stream: OTHER
