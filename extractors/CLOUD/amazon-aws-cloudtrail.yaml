schema-version: 1.0
#extractor-version: 1
extractor-id: 700
integration: AWS S3
vendor-name: Amazon
product-name: AWS CloudTrail
source-name: AWS-CLOUDTRAIL
source-type: CLOUD
source-description: Extractor for AWS CloudTrail Events
provides-streams:
- AUTHENTICATION
- CONFIGURATION
- CLOUDTRAIL
- IAM
master-filters:
- '\"eventVersion\"\:.*?\"awsRegion\"\:\s*\".*?\"\,'
event-details:
- first-match: '\"eventSource\"\:\s*\"[\w\.]+\"\,'
  decoder: json
  event-key-format: '{eventName}-{eventSource}'
  event-key-mapping:
    'ConsoleLogin-signin.amazonaws.com':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
      translate:
        userIdentity[userName]: User
        sourceIPAddress: SrcIP
        AuthProto: AuthProto
        errorMessage: Reason
        responseElements[ConsoleLogin]: Status
    'UserAuthentication-signin.amazonaws.com':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
      translate:
        userIdentity[userName]: User
        sourceIPAddress: SrcIP
        AuthProto: AuthProto
        errorMessage: Reason
        serviceEventDetails[UserAuthentication]: Status
    'CreatePolicyVersion-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'DeletePolicyVersion-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'AttachGroupPolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'DetachGroupPolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'AttachRolePolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'DetachRolePolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'PutRolePolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'PutUserPolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'PutGroupPolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config 
    'DetachUserPolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config     
    'AttachUserPolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config           
    'CreatePolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'DeletePolicy-iam.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'DeleteRolePolicy-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: POLICY_ROLE_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'DeleteUserPolicy-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_POLICY_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'DeleteGroupPolicy-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: GROUP_POLICY_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'CreateUser-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_CREATED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'DeleteUser-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'UpdateUser-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_UPDATED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'AddUserToGroup-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_ADDED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'AddUsersToGroup-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_ADDED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'DeleteUserToGroup-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'CreateRole-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_ADDED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role
    'DeleteRole-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_REMOVED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role   
    'UpdateRole-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_ADDED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role     
    'ExitRole-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: USER_REMOVED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role     
    'CreateGroup-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: GROUP_CREATED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role     
    'DeleteGroup-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: GROUP_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role 
    'UpdateGroup-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: GROUP_UPDATED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role    
    'CreateLoginProfile-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: PASSWORD_CREATED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role    
    'UpdateLoginProfile-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: PASSWORD_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role    
    'DeleteLoginProfile-iam.amazonaws.com':
      annotate:
        Stream: IAM
        Action: PASSWORD_DELETED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        requestParameters[userName]: TargetUser
        userIdentity[type]: Role 
    'PutConfigurationRecorder-config.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'StopConfigurationRecorder-config.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'DeleteDeliveryChannel-config.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'PutDeliveryChannel-config.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config
    'DeleteConfigRule-config.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config  
    'DeleteEvaluationResults-config.amazonaws.com':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        userIdentity[userName]: User
        eventName: Config                                

  fallback:
    annotate:
      Stream: CLOUDTRAIL
    translate:
      eventType: EventType
      eventSource: EventSource
      eventName: EventName
      awsRegion: AwsRegion
      userIdentity[accessKeyId]: AccessKey
      userIdentity[type]: UserGroup
      sourceIPAddress: SrcIP
      userAgent: UserAgent
      requestParameters: RequestParameters
      responseElements: ResponseElements
      errorCode: ErrorCode
      userIdentity[arn]: UserArn
      userIdentity[userName]: User  

  globals:
    translate:
      eventTime: SystemTstamp
      System: System

  subs: 
    Status:
      'Failure': 'FAILED'
      'Success': 'PASSED'
      'FAILED': 'FAILED'
      'PASSED': 'PASSED'