schema-version: 1.0
#extractor-version: 1
extractor-id: 172
source-name: AZURE-ACTIVITY
source-type: CLOUD
source-description: Extractor for Azure Activity Events
provides-streams:
- CLOUD
master-filters:
- time\:\s+\d{4}\-\d{2}\-\d{2}T\d{1,2}\:\d{1,2}\:\d{1,2}.*?(?:resourceId|tenantId).*?category\:\s+(?:AuditEvent|Delete|Action|Write|SignInLogs|AuditLogs|OperationLogs|Administrative|ResourceHealth|recommendationsdation|Recommendation|ServiceHealth|DeviceComplianceOrg|RequestResponse|Errors)
- \{time\:\s+\d{4}\-\d{2}\-\d{2}T\d{1,2}\:\d{1,2}\:\d{1,2}\.\w+\,\s+resourceId\:\s+\S+\,\s+dimensions\:\s+\{
- \s+resourceId\:\s+\S+\,\s+time\:\s+\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}\.\d+Z\,\s+metricName\:\s+  
event-details:
- first-match: \s+category\:\s+\S+\,
  decoder: custom
  decoder-regex: ([\w]+)\:\s+([^\,]*|[^\}]+)\,?
  event-key-format: '{category}'
  event-key-mapping:
    'Action':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        action: ActionTaken
        callerIpAddress: SrcIP
        role: Role
        groups: UserGroup
        level: LogLevel
        requestbody: Request
        eventCategory: EventType
        eventName: EventName
        type: TargetType 
    'AuditLogs':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        result: SubStatus
        category: SubCategory
        level: LogLevel
        resultReason: Reason
        type: TargetType
        userPrincipalName: TargetUser
    'SignInLogs':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        level: LogLevel
        callerIpAddress: SrcIP
        UserName: User
        Protocol: Proto
        userPrincipalName: TargetUser  
    'AuditEvent':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        callerIpAddress: SrcIP 
    'OperationLogs':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        callerIpAddress: SrcIP  
        #Query: QueryString
        #Description: Message 
    'Administrative':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        eventCategory: EventType
        details: EventName
        role: Role
        action: ActionTaken
        name: User
        groups: UserGroup
        requestbody: Request 
        #message: Message
    'ResourceHealth':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        eventCategory: EventType
        details: EventName
        type: TargetType 
    'Write':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        eventCategory: EventType
        details: EventName
        callerIpAddress: SrcIP
        role: Role
        action: ActionTaken
        name: User
        groups: UserGroup 
        responseBody: Response
    'Recommendation':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        eventCategory: EventType
        eventName: EventName 
    'ServiceHealth':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        eventCategory: EventType
        eventName: EventName
    'DeviceComplianceOrg':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        UserName: User 
        UserId: UserID 
    'Delete':
      annotate:
        Stream: CLOUD
      translate:
        resourceId: ResourceID
        operationName: OperationName
        category: Category
        resultType: resultType
        level: LogLevel
        callerIpAddress: SrcIP
        role: Role
        action: ActionTaken
        name: User
        groups: UserGroup 
        responseBody: Response                                         
    
  fallback:
    annotate:
      EventName: Generic Azure Activity Event
      Stream: OTHER

  globals:
    translate:
      time: SystemTstamp