schema-version: 1.0
#extractor-version: 1
extractor-id: 241
source-name: MODSECURITY
source-type: WAF
source-description: Extractor for ModSecurity WAF Events
provides-streams:
- WAF
master-filters:
- '\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}\s+\S+\s+(?:Apache\-Error|Message\:\s+Warning\.\s+Pattern\s+match|Message\:\s+Warning\.\s+detected\s+XSS)'
- '\[\w{3}\s+\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}\.\d+\s+\d+\]\s+\[\:error\]\s+.*?\s+ModSecurity\:\s+'
event-details:
- first-match: '\[tag\s+\"attack\-xss\"\]'
  decoder: regex
  decoder-regex: '(?P<datetime>\w+\s+\d+\s+\d+\:\d+\:\d+)\s+\S+\s+(?:.*?\[client\s+(?P<src>\d+\.\d+\.\d+\.\d+)(?:\:(?P<sport>\d+))?\])?.*?\[file\s+\"(?P<filepath>.*?)\"\]\s+.*?\[id\s+\".*?\]\s+.*?\[msg\s+\"(?P<message>.*?)\]\s+\[data\s+\"(?:.*?ARGS\:(?:param|message|subject|password)\:\s+(?P<app>.*?)|.*?)?\"\]\s+\[severity\s+\"(?P<severity>.*?)\"\]\s+\[ver\s+\"(?P<version>.*?)\"\].*?\s+\[tag\s+\".*?\"\]\s+\[tag\s+\".*?\"\]\s+\[tag\s+\".*?\"\]\s+\[tag\s+\"(?P<atkname>.*?)\"\]\s+\[tag\s+\"(?P<atkdesc>.*?)\"\]\s+(?:.*?\[hostname\s+\"(?P<dst>..*?)\"\]\s+\[uri\s+\"(?P<url>.*?)\"\])?'
  event-key-format: '{atkname}'
  event-key-mapping:
    'attack-xss':
      annotate:
        Stream: WAF
        Action: ATTACK_DETECTED
        Status: PASSED
      translate:
        src: SrcIP
        sport: SrcPort
        filepath: FilePath
        app: App
        severity: Severity
        atkdesc: AtkDesc
        dst: DstIP
        url: URL 

  fallback:
    annotate:
      EventName: Generic ModSecurity WAF Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp