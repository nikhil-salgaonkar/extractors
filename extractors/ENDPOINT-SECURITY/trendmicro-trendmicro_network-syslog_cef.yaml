schema-version: 1.0
#extractor-version: 1
extractor-id: 804
integration: Syslog(CEF)
vendor-name: Trend Micro
product-name: Trend-Micro Network
source-name: TREND-MICRO
source-type: NETWORK-SECURITY
source-description: Extractor for Trend-Micro Network Events
provides-streams:
- THREAT
- AUTHENTICATION
- CONFIGURATION
master-filters:
- 'CEF\:\d+\|Trend\s+Micro\|(?:TippingPoint\s+Threat\s+Protection\s+Analyzer|Deep\s+Discovery\s+Analyzer|Deep\s+Discovery\s+Inspector)'  
event-details:
- first-match: 'CEF\:\d+\|Trend\s+Micro\|(?:TippingPoint\s+Threat\s+Protection\s+Analyzer|Deep\s+Discovery\s+Analyzer|Deep\s+Discovery\s+Inspector)\|[\d\.]+\|(?:200120\|Deny\s+List\s+updated|300102)'
  decoder: custom
  decoder-regex: '([^\s\|]+)=([^=]+|)(?=\s+\w+=|$)'
  event-key-format: '{Header-4}-{outcome}'
  decoder-header: CEF
  event-key-mapping: 
    '200120-None':
      annotate: 
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        User: User 
        Header-5: Config      
    '300102-Success':
      annotate: 
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        duser: User  
        Header-5: Config    
    '300102-Failure':
      annotate: 
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: FAILED
      translate:
        duser: User  
        Header-5: Config     
  
  fallback:
    annotate:
      EventName: Generic Trend-Micro Network Events
      Stream: OTHER

  globals:
    translate:
      rt: SystemTstamp
      dvchost: System

- first-match: 'CEF\:\d+\|Trend\s+Micro\|Deep\s+Discovery\s+(?:Inspector|Analyzer)?\|[\d\.]+\|300999\|User\s+logged\s+(?:on|off)\|'
  decoder: custom
  decoder-regex: '([^\s\|]+)=([^=]+|)(?=\s+\w+=|$)'
  event-key-format: '{Header-5}-{outcome}'
  decoder-header: CEF
  event-key-mapping:
    'User logged on-Success': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        duser: User
        src: SrcIP
        AuthProto: AuthProto
    'User logged on-Failure': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        duser: User
        src: SrcIP
        AuthProto: AuthProto
    'User logged off-Success': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        duser: User
        src: SrcIP
        AuthProto: AuthProto 
    'User logged off-Failure': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: FAILED
        Reason: INVALID_CREDENTIALS
      translate:
        duser: User
        src: SrcIP
        AuthProto: AuthProto   
    
  fallback:
    annotate:
      EventName: Generic Trend-Micro Network Event
      Stream: OTHER

  globals:
    translate: 
      dvchost: System
      rt: SystemTstamp

- first-match: CEF\:\d+\|Trend\s+Micro\|Deep\s+Discovery\s+(?:Inspector|Analyzer)?\|[\d\.]+\|300999\|Log\s+Settings\:\s+Settings\s+modified\s+by\s+\'\S+\'\s+from\s+[\w\.\:]+\|
  decoder: custom
  decoder-regex: '([^\s\|]+)=([^=]+|)(?=\s+\w+=|$)'
  event-key-format: '{outcome}'
  decoder-header: CEF
  event-key-mapping:
    'Success': 
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        duser: User
        Header-5: Config
    'Failure': 
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: FAILED
      translate:
        duser: User
        Header-5: Config 
    
  fallback:
    annotate:
      EventName: Generic Trend-Micro Network Event
      Stream: OTHER

  globals:
    translate: 
      dvchost: System
      rt: SystemTstamp

- first-match: 'CEF\:\d+\|Trend\s+Micro\|Deep\sDiscovery\sInspector\|.*?cn3Label\=Threat\s+Type'
  decoder: custom
  decoder-regex: '([^\s\|]+)=([^=]+|)(?=\s+\w+=|$)'
  event-key-format: '{cn3}'
  decoder-header: CEF
  event-key-mapping:
    '0': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL
    '1': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL
    '2': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL
    '3': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL
    '4': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL
    '5':  
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL 
    '6':  
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        cn3: Threat
        src: SrcIP
        dst: DstIP
        CommandLine: CommandLine
        suser: User
        fname: File
        Process: Process
        request: URL 
    
  fallback:
    annotate:
      EventName: Generic Trend-Micro Network Event
      Stream: OTHER

  globals:
    translate: 
      dvchost: System
      rt: SystemTstamp

  subs: &id001
    Threat:
      '0': Malicious content
      '1': Malicious behavior
      '2': Suspicious behavior
      '3': Exploit
      '4': Grayware
      '5': Suspicious URL
      '6': Disruptive Applications