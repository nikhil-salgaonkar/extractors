schema-version: 1.0
#extractor-version: 1
extractor-id: 94
source-name: SYMANTEC_ATP
source-type: ENDPOINT
source-description: Extractor for Symantec ATP Endpoint
provides-streams:
- ENDPOINT-THREAT
master-filters:
- CEF\:\d+\|Symantec\|
event-details:
- first-match: \|lcp\_sep\_alert\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{alert}'
  event-key-mapping:
    Virus found:
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECTED
        Status: PASSED
      translate:
        virus_name: AtkMsg
        user_name: User
        device_name: SrcHost
        domain_name: Domain
        device_ip: SrcIP
        app_name: FileName

  fallback:
      annotate:
        EventName: Generic Symantec ATP Endpoint Event
        Stream: OTHER

  globals:
    translate:
      host_name: HostName

- first-match: \|sep\_proxy\_ips\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{technology}'
  event-key-mapping:
    ClientIDS Attacks:
      annotate:
        Stream: ENDPOINT-THREAT
        Action: ATTACK_DETECTED
        Status: PASSED
      translate:
        user_name: User
        data_source_url_domain: Domain
        source_ip: SrcIP
        app_name: FileName
        data_source_url: URL
        signature_name: SignName

  fallback:
      annotate:
        EventName: Generic Symantec ATP Endpoint Event
        Stream: OTHER

- first-match: \|lcp\_sep\_risk\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{event_id}'
  event-key-mapping:
    "206":
      annotate:
        Stream: ENDPOINT-THREAT
        Action: THREAT_DETECTED
        Status: PASSED
      translate:
        user_name: User
        device_name: SrcHost
        domain_name: Domain
        device_ip: SrcIP
        app_name: FileName
        intrusion_url: URL
        signature_name: SignName

  fallback:
      annotate:
        EventName: Generic Symantec ATP Endpoint Event
        Stream: OTHER


- first-match: \|atp\_incident\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{rule_name}'
  event-key-mapping:
    Advanced Attack Technique:
      annotate:
        Stream: ENDPOINT-THREAT
        Action: ATTACK_DETECTED
        Status: PASSED
      translate:
        virus_name: AtkMsg
        user_name: User
        device_name: SrcHost
        domain_name: Domain
        device_ip: SrcIP
        app_name: FileName

  fallback:
      annotate:
        EventName: Generic Symantec ATP Endpoint Event
        Stream: OTHER

  globals:
    translate:

- first-match: \|sep\_proxy\_sonar\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{submission_type}'
  event-key-mapping:
    BASH-SONAR-TEST-BAD:
      annotate:
        Stream: ENDPOINT-THREAT
        Action: VIRUS_DETECTED
        Status: PASSED
      translate:
        user_name: User
        device_name: SrcHost
        device_ip: SrcIP
        app_name: FileName
        virus_name: AtkMsg

  fallback:
      annotate:
        EventName: Generic Symantec ATP Endpoint Event
        Stream: OTHER

#  globals:
 #   translate:

- first-match: \|sep\_proxy\_av\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{technology}'
  event-key-mapping:
    AV Engine:
      annotate:
        Stream: ENDPOINT-THREAT
        Action: THREAT_DETECTED
        Status: PASSED
      translate:
        user_name: User
        device_name: SrcHost
        device_ip: SrcIP
        app_name: FileName

  fallback:
      annotate:
        EventName: Generic Symantec ATP Endpoint Event
        Stream: OTHER
