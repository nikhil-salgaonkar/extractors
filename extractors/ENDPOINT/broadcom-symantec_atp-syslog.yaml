schema-version: 1.0
#extractor-version: 1
extractor-id: 94
source-name: SYMANTEC_ATP
source-type: ENDPOINT
source-description: Extractor for Symantec ATP Endpoint Events
provides-streams:
- THREAT
master-filters:
- CEF\:\d+\|Symantec\|
event-details:
- first-match: \|lcp\_sep\_alert\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{alert}'
  event-key-mapping:
    Virus found:
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        AVEVirusName: Threat
        SrcIP: SrcIP
        DstIP: DstIP
        user_name: User
        CommandLine: CommandLine
        app_name: File
        URL: URL
        Process: Process
        app_name: Suspect
        host_name: Target
        
  fallback:
    annotate:
      EventName: Generic Symantec ATP Endpoint Event
      Stream: OTHER

  globals:
    translate:
      host_name: System
      device_time: SystemTstamp

- first-match: \|sep\_proxy\_ips\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{technology}'
  event-key-mapping:
    ClientIDS Attacks:
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        Threat: Threat
        source_ip: SrcIP
        DstIP: DstIP
        user_name: User
        CommandLine: CommandLine
        name: File
        data_source_URL: URL
        Process: Process
        user_name: Suspect
        device_name: Target
  
  fallback:
    annotate:
      EventName: Generic Symantec ATP Endpoint Event
      Stream: OTHER

  globals:
    translate:
      device_name: System
      device_time: SystemTstamp

- first-match: \|lcp\_sep\_risk\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{event_id}'
  event-key-mapping:
    "206":
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        Threat: Threat
        SrcIP: SrcIP
        DstIP: DstIP
        user_name: User
        CommandLine: CommandLine
        File: File
        URL: URL
        Process: Process
        Suspect: Suspect
        Target: Target
  
  fallback:
    annotate:
      EventName: Generic Symantec ATP Endpoint Event
      Stream: OTHER

  globals:
    translate:
      host_name: System
      device_time: SystemTstamp

- first-match: \|atp\_incident\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{rule_name}'
  event-key-mapping:
    Advanced Attack Technique:
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        heuristicevent_virus_name: Threat
        SrcIP: SrcIP
        DstIP: DstIP
        user_name: User
        heuristicevent_scored_process_cmdline: CommandLine
        name: File
        URL: URL
        Process: Process
        image_path: Suspect
        device_name: Target
  
  fallback:
    annotate:
      EventName: Generic Symantec ATP Endpoint Event
      Stream: OTHER

  globals:
    translate:
      device_name: System
      device_time: SystemTstamp

- first-match: \|sep\_proxy\_sonar\_event\|
  decoder: custom
  decoder-regex: \{?\"?([^\=\"\,]+)\"?(?:\:|\=)?\"?([^\"\s\,}]+)\"?
  event-key-format: '{submission_type}'
  event-key-mapping:
    BASH-SONAR-TEST-BAD:
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        virus_name: Threat
        SrcIP: SrcIP
        DstIP: DstIP
        user_name: User
        CommandLine: CommandLine
        fname: File
        URL: URL
        Process: Process
        fname: Suspect
        device_name: Target

  fallback:
    annotate:
      EventName: Generic Symantec ATP Endpoint Event
      Stream: OTHER

  globals:
    translate:
      device_name: System
      device_time: SystemTstamp

- first-match: \|sep\_proxy\_av\_event\|
  decoder: custom
  decoder-regex: \"(\w+)\":([^\,{}]+)
  event-key-format: '{technology}'
  event-key-mapping:
    AV Engine:
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        AVEVirusName: Threat
        SrcIP: SrcIP
        DstIP: DstIP
        user_name: User
        CommandLine: CommandLine
        fname: File
        URL: URL
        Process: Process
        name: Suspect
        device_name: Target

  fallback:
    annotate:
      EventName: Generic Symantec ATP Endpoint Event
      Stream: OTHER

  globals:
    translate:
      device_name: System
      device_time: SystemTstamp