schema-version: 1.0
#extractor-version: 1
extractor-id: 6001
source-name: CARBON-BLACK
source-type: EPP
source-description: extractor for Carbon Black EPP Events
provides-streams:
- THREAT
- IAM
master-filters:
- '\d+\-\d+\-\d+T\d+\:\d+\:\d+Z\s+\S+\s+[\s\-]+Cb\s+Protection\s+event\:\s+'
event-details:
- first-match: 'Cb\s+Protection\s+event\:\s+(?!.*?process_threat)'
  decoder: custom
  decoder-regex: '(\w+)\=\"([^\"]+)\"'
  event-key-format: '{type}-{subtype}'
  event-key-mapping:
    'Session Management-Console user created':
      annotate:
        Stream: IAM
        Action: USER_CREATED
        Status: PASSED
      translate:
        ip_address: SrcIP
        username: User
        rolename: RoleName
        #modifiedproperties: ModificationProperties
    'Session Management-Console user deleted':
      annotate:
        Stream: IAM
        Action: USER_CREATED
        Status: PASSED
      translate:
        ip_address: SrcIP
        username: User
        rolename: RoleName
        #modifiedproperties: ModificationProperties
    'Session Management-Console user modified':
      annotate:
        Stream: IAM
        Action: USER_CREATED
        Status: PASSED
      translate:
        ip_address: SrcIP
        username: User
        rolename: RoleName
        #modifiedproperties: ModificationProperties
    
  fallback:
    annotate:
      EventName: Generic Carbon Black EPP Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      hostname: System

- first-match: 'Cb\s+Protection\s+event\:\s+.*?process_threat'
  decoder: custom
  decoder-regex: '(\w+)\=\"([^\"]+)\"'
  event-key-format: '{process_threat}'
  event-key-mapping:
    '1':
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        ip_address: SrcIP
        username: User
        dest_ipaddress: DstIP
        indicator_name: Threat
        command_line: Cmd
        file_name: File
        process: Process
        url: URL
    '2':
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: HOST
      translate:
        ip_address: SrcIP
        username: User
        dest_ipaddress: DstIP
        indicator_name: Threat
        command_line: Cmd
        file_name: File
        process: Process
        url: URL
    
  fallback:
    annotate:
      EventName: Generic Carbon Black EPP Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      hostname: System