schema-version: 1.0
#extractor-version: 1
extractor-id: 177
integration: Syslog
vendor-name: Cisco TACACS
product-name: Cisco TACACS
source-name: Cisco-TACACS
source-type: AAA
source-description: Extractor for Cisco-TACACS Events
provides-streams:
- AUTHENTICATION
master-filters:
- '^(?:\<\d+\>)?\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}\s+\S+\s+(?:CSCOacs\_Passed\_Authentications|CSCOacs\_Failed\_Attempts|CSCOacs\_TACACS\_Accounting)'
event-details:
- first-match: 'Device\-Administration\:\s+(?:Session|Command)\s+Authorization\s+succeeded\,.*?Type\=Authorization\, '
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,\/]+)'
  event-key-format: '{Privilege-Level}-{CmdSet}'
  event-key-mapping:
    '0-[ CmdAV=logout ]':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        Protocol: AuthProto 
        UserName: User
        Device IP Address: SrcIP   
    '1-[ CmdAV= ]':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        Protocol: AuthProto
        UserName: User
        Device IP Address: SrcIP  
    '1-None':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        Protocol: AuthProto 
        UserName: User
        Device IP Address: SrcIP   
    '15-[ CmdAV=system-view CmdArgAV=<cr> ]':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        Protocol: AuthProto 
        UserName: User
        Device IP Address: SrcIP 

  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS Event
      Stream: OTHER

  globals:
    translate:
      AcsSessionID: System
      SystemTstamp: SystemTstamp

- first-match: 'Device\-Administration\:\s+Authorization\s+failed\,.*?Type\=Authorization\,'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,\/]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_USER
      translate:
        Protocol: AuthProto 
        UserName: User
        Device IP Address: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      AcsSessionID: System
      SystemTstamp: SystemTstamp

- first-match: 'Authentication:\s+Authentication\s+succeeded\,.*?Type\=Authentication\,'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,\/]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        Protocol: AuthProto 
        UserName: User
        Device IP Address: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      AcsSessionID: System
      SystemTstamp: SystemTstamp

- first-match: 'Failed\-Attempt\:\s+Authentication\s+failed\,.*?Type\=Authentication\,'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,\/]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_USER
      translate:
        Protocol: AuthProto
        UserName: User
        Device IP Address: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      AcsSessionID: System
      SystemTstamp: SystemTstamp

- first-match: '\{Type\=(?:Authentication|Authorization)\;\s+(?:Authen|Author)\-Reply\-Status\=(?:PassAdd|Pass)\;\s+\}'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        AuthProto: AuthProto 
        AD-User-Candidate-Identities: User
        SrcIP: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      System: System
      SystemTstamp: SystemTstamp

- first-match: '\{AuthenticationResult\=Passed\;\s+AuthorizationFailureReason=ShellProfileDenyAuthorization;\s+Type\=Authentication;\s+Authen\-Reply\-Status\=Fail\;\s+\}'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_USER
      translate:
        AuthProto: AuthProto 
        AD-User-Candidate-Identities: User
        SrcIP: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      System: System
      SystemTstamp: SystemTstamp

- first-match: 'CSCOacs\_Passed\_Authentications\s+\d+\s+\d+\s+\d+\s+\w+\=Device\s+Type\:All\s+Device\s+Types\:\w+\,'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        AuthProto: AuthProto 
        AD-User-Candidate-Identities: User
        SrcIP: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      System: System
      SystemTstamp: SystemTstamp

- first-match: 'CSCOacs\_Failed\_Attempts\s+\d+\s+\d+\s+\d+\s+\w+\=Device\s+Type\:All\s+Device\s+Types\:\w+\,'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_USER
      translate:
        AuthProto: AuthProto 
        AD-User-Candidate-Identities: User
        SrcIP: SrcIP   
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      System: System
      SystemTstamp: SystemTstamp

- first-match: 'Type\=Accounting\,'
  decoder: custom
  decoder-regex: '\,\s([\w\-\s]+)\=([^\,\/]+)'
  event-key-format: '{Privilege-Level}'
  event-key-mapping: 
    '1':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        Authen-Method: AuthProto
        User: User
        Device IP Address: SrcIP     
    '15':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        Authen-Method: AuthProto 
        User: User
        Device IP Address: SrcIP  
    
  fallback:
    annotate:
      EventName: Generic for Cisco-TACACS AAA Evnt
      Stream: OTHER

  globals:
    translate:
      AcsSessionID: System
      SystemTstamp: SystemTstamp