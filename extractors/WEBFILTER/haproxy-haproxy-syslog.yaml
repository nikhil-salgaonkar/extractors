schema-version: 1.0
#extractor-version: 1
extractor-id: 235
source-name: HAPROXY
source-type: WEBFILTER
source-description: Extractor for HAProxy
provides-streams:
- WEBFILTER
master-filters:
- 'haproxy\[\d+\]\:\s+.*?\:\d+\s+\[\d+\/\w+\/\d{4}\:\d+\:\d+\:\d+.\d+\]'
event-details:
- first-match: 'haproxy\[\d+\]\:'
  decoder: regex
  decoder-regex: '\w+\s+\d+\s+\d+\:\d+\:\d+\s(?P<systemname>.*?)\s+(?P<daemon>.*?)\[(?P<pid>\d+)\]\:\s+(?P<src_ip>.*?)\:(?P<src_port>.*?)\s+.*?\[(?P<datetime>\d+\/\w+\/\d{4}\:\d+\:\d+\:\d+).*?\]\s+(?P<frontend_name>\S+)\s+(?P<backend_name>.*?)\/(?P<server_name>.*?)\s+(?P<request_time_seconds>\d+)\/(?P<wait_time_seconds>[\d\-]+)\/(?P<conn_time_seconds>[\d\-]+)\/(?P<respone_time_seconds>.*?)\/(\d+)\s+(?P<status_code>\S+)\s+(?P<txlen>\d+)\s+\-\s+\-.*?\-\s+(?P<act_conn>\d+)\/(?P<fe_conn>\d+)\/(?P<be_conn>\d+)\/(?P<srv_conn>\d+)\/(?P<retries_conn>\d+)\s+(?P<server_queue>\d+)\/(?P<backend_queue>\d+)\s+\"(?P<http_method>.*?)\s+(?P<file_path>[\/\S]+)(?:\s+.*?\")?'
  event-key-format: '{status_code}'
  event-key-mapping:
    '200':
      annotate:
        Stream: WEBFILTER
        Action: URL_ALLOWED
        Status: PASSED
      translate:
        src_ip: SrcIP
        src_port: SrcPort
        #url: URL
        method: Method
        txlen: TXLen
        user: User

  fallback:
      annotate:
        EventName: Generic HAProxy Event
        Stream: OTHER
      translate:
        datetime: SystemTstamp

  globals:
    translate:
      datetime: SystemTstamp
      systemname: System