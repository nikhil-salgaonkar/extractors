schema-version: 1.0
#extractor-version: 1
extractor-id: 58
integration: syslog
vendor-name: Juniper
product-name: Juniper-Firewall
source-name: JUNIPER
source-type: FIREWALL
source-description: Extractor for Juniper Firewall Events
provides-streams:
- AUTHENTICATION
- FIREWALL
- THREAT
- CONFIGURATION
master-filters:
- '^(?:\<\d+\>)?\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}\s+\S+\s+(?:RT\_FLOW|kmd|RT\_IPSEC|mgd|sshd|checklogin|junos\-alg|rpd|ip\_mon\_reth\_scan|L2ALM|xntpd|PFE\_FW\_SYSLOG\_IP|RT\_IDS)\:?\[?'
- '^(?:\<\d+\>)?\d{4}\-\d{1,2}\-\d{2}\s+\d{2}\:\d{2}\:\d{2}\s+\w+\,\s+Filter\:\s+\w+\,'
event-details:
- first-match: '(?:UI_LOGIN_EVENT|UI_LOGOUT_EVENT)\:\s+User\s+\w+'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\[(?P<pid>\d+)\]\:\s+(?P<category>\S+)\:\s+User\s+(?P<user>\w+)\s+\w+\,?.*?\,\s+(?P<proto>\w+)[\w\-]+(?:\s+(?P<src>[\d\.]+))?'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_LOGIN_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED   
      translate:
        src: SrcIP 
        user: User
        proto: AuthProto
    'UI_LOGOUT_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED   
      translate:
        src: SrcIP 
        user: User
        proto: AuthProto

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System


- first-match: 'SSHD_LOGIN_FAILED\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\:\s+(?P<category>\S+)\:.*?user\s+(?P<user>.*?)\s+.*?(?P<src>[\d\.]+)'
  event-key-format: '{category}'
  event-key-mapping:
    'SSHD_LOGIN_FAILED': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        AuthProto: SSH
      translate:
        user: User
        src: SrcIP 
        Reason: Reason  
      
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'PFE\_FW\_SYSLOG\_IP\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<category>\S+)\:\s+FW\:\s+\S+\s+(?P<action>\w+)\s+(?P<proto>\w+)\s+(?P<src>[\d\.]+)\s+(?P<dst>[\d\.]+)\s+(?P<sport>\d+)\s+(?P<dport>\d+)\s+\((?P<sent_bytes>\w+)\s+packets\)'
  event-key-format: '{action}'
  event-key-mapping:
    'R': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: FAILED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        RXLen: RXLen
        App: App
    'A': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_ALLOWED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        RXLen: RXLen
        App: App 
    'D': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: FAILED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        RXLen: RXLen
        App: App  
    'drop': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        RXLen: RXLen
        App: App            

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System  

- first-match: 'Filter\:\s+\w+\,\s+Filter\s+action\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\d{4}\-\d{1,2}\-\d{2}\s+\d{2}\:\d{2}\:\d{2})\s+\w+\,\s+Filter\:\s+\w+\,\s+Filter\s+action\:\s+(?P<action>\w+)\,\s+Name\s+of\s+interface\:.*?Name of protocol\:\s+(?P<proto>\w+)\,\s+Packet\s+Length\:\s+(?P<sent_bytes>\d+)\,\s+Source\s+address\:\s+(?P<src>[\d\.]+)\:(?P<sport>\d+)\,\s+Destination\s+address\:\s+(?P<dst>[\d\.]+)\:(?P<dport>\d+)'
  event-key-format: '{action}'
  event-key-mapping:
    'accept': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_ALLOWED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        RXLen: RXLen
        App: App

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System           

- first-match: 'RT\_IDS\:\s+RT_SCREEN_\w+\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s\S+\:\s+(?P<category>\S+)\:\s+(?P<threat>.*?)\s+source\:\s+(?P<src>[\d\.]+).*?\,\s+destination\:\s+(?P<dst>[\d\.]+).*?\,.*?action\:\s+(?P<action>[\w\-]+)'
  event-key-format: '{category}'
  event-key-mapping:
    'IDP_ATTACK_LOG_EVENT': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        User: User
    'FLOW_IP_ACTION': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        User: User
    'RT_SCREEN_UDP': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        User: User
    'RT_SCREEN_IP': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        User: User
    
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'RT\_FLOW:\s+(?:APPTRACK\_SESSION\_CLOSE|RT_FLOW: APPTRACK_SESSION_CREATE|RT_FLOW_SESSION_CLOSE):'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+\S+\:\s+(?P<category>\S+)\:.*?(?P<src>[\d\.]+)\/(?P<sport>\d+)\-\>(?P<dst>[\d\.]+)\/(?P<dport>\d+)\s+(?P<app>\S+).*?[\d\.]+\/\d+\-\>[\d\.]+\/\d+[\s\D]+(?P<proto>\d+).*?\((?P<sent_bytes>\d+)\)\s+\d+\((?P<rcvd_bytes>\d+)\)'
  event-key-format: '{category}'
  event-key-mapping:
    'APPTRACK_SESSION_CLOSE':  
      annotate:
        Stream: FIREWALL
        Action: SESSION_TERMINATED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        rcvd_bytes: RXLen
        app: App
    'APPTRACK_SESSION_CREATE':  
      annotate:
        Stream: FIREWALL
        Action: SESSION_ESTABLISHED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        rcvd_bytes: RXLen
        app: App
    'RT_FLOW_SESSION_CLOSE':  
      annotate:
        Stream: FIREWALL
        Action: SESSION_TERMINATED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        sent_bytes: TXLen
        rcvd_bytes: RXLen
        app: App
    
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

  subs: &id001
    Proto:
      '1': ICMP
      '2': IGMP
      '6': TCP
      '17': UDP
      '38': IDPR-CMTP
      '40': IPv6
      '46': RSVP
      '47': GRE
      '50': ESP
      '51': AH
      '54': NARP
      '89': OSPNIGP
      '94': IPIP
      '99': ANY
      '132': SCTP

- first-match: 'RT\_FLOW:\s+RT\_FLOW\_SESSION\_DENY:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+\S+\:\s+(?P<category>\S+)\:.*?(?P<src>[\d\.]+)\/(?P<sport>\d+)\-\>(?P<dst>[\d\.]+)\/(?P<dport>\d+)\s+(?P<app>\S+)\s+(?P<proto>\d+)'
  event-key-format: '{category}'
  event-key-mapping:
    'RT_FLOW_SESSION_DENY':  
      annotate:
        Stream: FIREWALL
        Action: SESSION_TERMINATED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        TXLen: TXLen
        RXLen: RXLen
        app: App
    
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

  subs: *id001

- first-match: 'RT\_FLOW:\s+RT\_FLOW\_SESSION\_CREATE:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+\S+\:\s+(?P<category>\S+)\:.*?(?P<src>[\d\.]+)\/(?P<sport>\d+)\-\>(?P<dst>[\d\.]+)\/(?P<dport>\d+)\s+(?P<app>\S+)\s+[\d\.]+\/\d+\-\>[\d\.]+\/\d+\s+\S+\s+\w+\s+(?P<proto>\d+)'
  event-key-format: '{category}'
  event-key-mapping:
    'RT_FLOW_SESSION_CREATE':  
      annotate:
        Stream: FIREWALL
        Action: SESSION_ESTABLISHED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        TXLen: TXLen
        RXLen: RXLen
        app: App
    
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

  subs: *id001

- first-match: 'mgd\[\d+\]\:\s+UI\_CFG\_AUDIT\_OTHER'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\[(?P<pid>\d+)\]\:\s+(?P<category>\S+)\:\s+User\s+(?P<user>\w+)\s+\w+\:\s+(?P<config>\S+)'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_CFG_AUDIT_OTHER':  
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
      translate:
        user: User
        config: Config
    
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System


  