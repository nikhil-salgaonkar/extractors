schema-version: 1.0
#extractor-version: 1
extractor-id: 58
integration: syslog
vendor-name: Juniper
product-name: Juniper-Firewall
source-name: JUNIPER
source-type: FIREWALL
source-description: Extractor for Juniper Firewall Events
provides-streams:
- AUTHENTICATION
- FIREWALL
- THREAT
master-filters:
- '^(?:\<\d+\>)?\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2}\s+\S+\s+(?:RT\_FLOW|kmd|RT\_IPSEC|mgd|sshd|checklogin|junos\-alg|rpd|ip\_mon\_reth\_scan|L2ALM|xntpd|PFE\_FW\_SYSLOG\_IP|RT\_IDS)\:?\[?'
- '^(?:\<\d+\>)?\d{4}\-\d{1,2}\-\d{2}\s+\d{2}\:\d{2}\:\d{2}\s+\w+\,\s+Filter\:\s+\w+\,'
event-details:
- first-match: 'UI_LOGIN_EVENT\:\s+User\s+\S+\s+login\,\s+\w+\s+j\-super\-user'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\[(?P<pid>\d+)\]\:\s+(?P<category>\S+)\:\s+.*?\s(?P<user>.*?)\slogin.*?ssh-connection\s+(?P<src>[\d\.]+)\s+(?P<sport>\d+)\s+(?P<dst>[\d\.]+)\s+(?P<dport>\d+)'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_LOGIN_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED   
        AuthProto: SSH
      translate:
        src: SrcIP 
        user: User

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'UI_LOGOUT_EVENT\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>.*?)\[(?P<pid>\d+)\]\:\s+(?P<category>\S+)\:\s.*?\s(?P<user>\w+)\s+'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_LOGOUT_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED 
      translate:
        AuthProto: AuthProto
        user: User
        src: SrcIP

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'SSHD_LOGIN_FAILED\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\:\s+(?P<category>\S+)\:.*?user\s+(?P<user>.*?)\s+.*?(?P<src>[\d\.]+)'
  event-key-format: '{category}'
  event-key-mapping:
    'SSHD_LOGIN_FAILED': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        AuthProto: SSH
      translate:
        user: User
        src: SrcIP 
        reason: Reason  

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'UI_DBASE_LOGIN_EVENT\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\[(?P<pid>\d+)\]\:\s+(?P<category>\S+)\:\s+User\s+(?P<user>.*?)\s+'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_DBASE_LOGIN_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED  
      translate:
        AuthProto: AuthProto
        user: User
        src: SrcIP

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'UI_DBASE_LOGOUT_EVENT\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\[(?P<pid>\d+)\]\:\s+(?P<category>\S+)\:\s+User\s+(?P<user>.*?)\s+'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_DBASE_LOGOUT_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED 
      translate:
        AuthProto: AuthProto
        user: User
        src: SrcIP

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System
  
- first-match: 'UI_LOGIN_EVENT\:\s+User\s+\S+\s+login\,\s+class\s+super\-user'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<daemon>\w+)\[(?P<pid>\d+)\]\:\s(?P<category>\S+)\:\sUser\s(?P<user>\S+)\s+'
  event-key-format: '{category}'
  event-key-mapping:
    'UI_LOGIN_EVENT': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED  
        AuthProto: SSH
      translate:
        user: User
        src: SrcIP

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System

- first-match: 'PFE\_FW\_SYSLOG\_IP\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s+(?P<category>\S+)\:\s+FW\:\s+(?P<message>(?P<interface>\S+)\s+(?P<action>\w+)\s+(?P<proto>\w+)\s+(?P<src>[\d\.]+)\s+(?P<dst>[\d\.]+)\s+(?P<sport>\d+)\s+(?P<dport>\d+)\s+\((?P<packets>\w+)\s+packets\))'
  event-key-format: '{action}'
  event-key-mapping:
    'R': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: FAILED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        Packet Length: TXLen
        Service Name: App
    'A': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_ALLOWED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        Packet Length: TXLen
        Service Name: App 
    'D': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: FAILED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        Packet Length: TXLen
        Service Name: App  
    'drop': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        Packet Length: TXLen
        Service Name: App            

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System  

- first-match: 'Filter\:\s+\w+\,\s+Filter\s+action\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\d{4}\-\d{1,2}\-\d{2}\s+\d{2}\:\d{2}\:\d{2})\s+\w+\,\s+Filter\:\s+(\w+)\,\s+Filter\s+action\:\s+(?P<action>\w+)\,\s+Name\s+of\s+interface\:\s+(?P<interface>.*?)\s+Name of protocol\:\s+(?P<proto>\w+)\,\s+Packet Length\:\s+(?P<packet_length>\d+)\,\s+Source address\:\s+(?P<src>[\d\.]+)\:(?P<sport>\d+)\,\s+Destination address\:\s+(?P<dst>[\d\.]+)\:(?P<dport>\d+)'
  event-key-format: '{action}'
  event-key-mapping:
    'accept': 
      annotate:
        Stream: FIREWALL
        Action: PACKET_ALLOWED
        Status: PASSED
      translate:
        proto: Proto
        src: SrcIP
        dst: DstIP
        sport: SrcPort
        dport: DstPort
        packet_length: TXLen
        Service Name: App

  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System           

- first-match: 'RT\_IDS\:\s+RT_SCREEN_\w+\:'
  decoder: regex
  decoder-regex: '(?P<datetime>\w{3}\s+\d{1,2}\s+\d{2}\:\d{2}\:\d{2})\s+(?P<hostname>\S+)\s\S+\:\s+(?P<category>\S+)\:\s+(?P<threat>.*?)\s+source\:\s+(?P<src>[\d\.]+)(?:\:(?P<sport>\d+))?\,\s+destination\:\s+(?P<dst>[\d\.]+)(?:\:(?P<dport>\d+))?\,(?:\s+protocol\-id\:\s+(?P<protocol_id>\d+)\,)?\s+.*?interface\s+name\:\s+(?P<interface>.*?)\,\s+action\:\s+(?P<action>[\w\-]+)'
  event-key-format: '{category}'
  event-key-mapping:
    'IDP_ATTACK_LOG_EVENT': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        user: User
    'FLOW_IP_ACTION': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        user: User
    'RT_SCREEN_UDP': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        user: User
    'RT_SCREEN_IP': 
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        threat: Threat
        src: SrcIP
        dst: DstIP
        user: User
    
  fallback:
    annotate:
      EventName: Generic Juniper Firewall Event
      Stream: OTHER

  globals:
    translate:
      datetime: SystemTstamp
      hostname: System