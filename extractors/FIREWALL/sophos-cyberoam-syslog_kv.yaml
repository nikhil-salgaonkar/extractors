schema-version: 1.0
#extractor-version: 1
extractor-id: 54
integration: Syslog(KV)
vendor-name: Sophos
product-name: Cyberoam Firewall
source-name: CYBEROAM
source-type: FIREWALL
source-description: Extractor for Cyberoam Firewall Events
provides-streams:
- AUTHENTICATION
- THREAT
- FIREWALL
- CONFIGURATION
master-filters:
- '^(?:\<\d+\>)?(?:device\=\"\w+\"\s+)?date\=\d+\-\d+\-\d+\s+time\=\d+\:\d+\:\d+\s+timezone\=\"\S+\"\s+device_name\=\"\S+\"\sdevice_id\=\s?\w+\-?\w+\s+log_id\=\d+\s+'
event-details: 
- first-match: 'log\_id\=062009617507.*?logged\s+in'
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: ''
  event-key-mapping:  
    '': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        AuthProto: AuthProto
        user_name: User
        src_ip: SrcIP
        
  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System

- first-match: 'log\_id\=062009617507.*?logged\s+out'
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: ''
  event-key-mapping:  
    '': 
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        AuthProto: AuthProto
        user_name: User
        src_ip: SrcIP
        
  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System

- first-match: 'log\_type\=\"(?:IDP|Anti\-Virus|ATP)\"'
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: ''
  event-key-mapping:  
    '':
      annotate:
        Stream: THREAT
        Action: THREAT_DETECTED
        Status: PASSED
        Vector: WEB
      translate:
        user_name: User 
        signature_msg: Threat
        classification: Threat
        threatname: Threat
        virus: Threat
        src_ip: SrcIP
        sourceip: SrcIP
        dst_ip: DstIP 
        destinationip: DstIP    
    
  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System  

- first-match: 'log\_type\=\"(?:Content\s+Filtering|Firewall)\"'
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: '{log_subtype}'
  event-key-mapping:  
    'Allowed':
      annotate:
        Stream: FIREWALL
        Action: PACKET_ALLOWED
        Status: PASSED
      translate:
        src_ip: SrcIP
        dst_ip: DstIP
        protocol: Proto
        src_port: SrcPort
        dst_port: DstPort
        sent_bytes: TXLen
        recv_bytes: RXLen 
        application: App  
    'Denied':
      annotate:
        Stream: FIREWALL
        Action: PACKET_BLOCKED
        Status: PASSED
      translate:
        src_ip: SrcIP
        dst_ip: DstIP
        protocol: Proto
        src_port: SrcPort
        dst_port: DstPort
        sent_bytes: TXLen
        recv_bytes: RXLen 
        application: App 
    
  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System  

- first-match: 'log\_type\=\"Event\".*?connectiontype\='
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: '{status}'
  event-key-mapping:  
    'Successful':
      annotate:
        Stream: FIREWALL
        Action: CONNECTION_ESTABLISHED
        Status: PASSED
      translate:
        localinterfaceip: SrcIP
        remoteinterfaceip: DstIP
        Proto: Proto
        SrcPort: SrcPort
        DstPort: DstPort
        TXLen: TXLen
        RXLen: RXLen
        App: App    
    'Failed':
      annotate:
        Stream: FIREWALL
        Action: CONNECTION_ESTABLISHED
        Status: FAILED
      translate:
        localinterfaceip: SrcIP
        remoteinterfaceip: DstIP
        Proto: Proto
        SrcPort: SrcPort
        DstPort: DstPort
        TXLen: TXLen
        RXLen: RXLen
        App: App    
    'Established':
      annotate:
        Stream: FIREWALL
        Action: CONNECTION_ESTABLISHED
        Status: PASSED
      translate:
        localinterfaceip: SrcIP
        remoteinterfaceip: DstIP
        Proto: Proto
        SrcPort: SrcPort
        DstPort: DstPort
        TXLen: TXLen
        RXLen: RXLen
        App: App    
    'Terminated':
      annotate:
        Stream: FIREWALL
        Action: CONNECTION_TERMINATED
        Status: PASSED
      translate:
        localinterfaceip: SrcIP
        remoteinterfaceip: DstIP
        Proto: Proto
        SrcPort: SrcPort
        DstPort: DstPort
        TXLen: TXLen
        RXLen: RXLen
        App: App    

  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System  

- first-match: 'log\_id=(?:062009617501|062009617502|062009517503|062109517507|062910617701|062910517702|062910617703|063210617704|063210617706)\s+log_type\=\"Event\"'
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: '{log_id}-{status}'
  event-key-mapping:  
    '062009617501-Successful':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: Add Operation
      translate:
        user_name: User
    '062009617502-Successful':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: Update Operation
      translate:
        user_name: User
    '062009517503-Successful':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: Delete Operation
      translate:
        user_name: User    
    '062910617701-Successful':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        auth_mechanism: AuthProto
        user_name: User
        src_ip: SrcIP
    '062109517507-Failed':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: INVALID_CREDENTIALS
        AuthProto: SSH
      translate:
        user_name: User
        src_ip: SrcIP
    '062910617703-Successful':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        auth_mechanism: AuthProto
        user_name: User
        src_ip: SrcIP 
    '062910517702-Failed':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
      translate:
        auth_mechanism: AuthProto
        user_name: User
        src_ip: SrcIP
        reason: Reason
    '063210617706-Successful':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGOUT
        Status: PASSED
      translate:
        auth_mechanism: AuthProto
        user_name: User
        src_ip: SrcIP 
    '063210617704-Successful':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: PASSED
      translate:
        auth_mechanism: AuthProto
        user_name: User
        src_ip: SrcIP 

  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System  

- first-match: log_id\=062009517504.*?message\=\".*?(?:accepted|changed)\s+by\s+\S+\s+from\s+[\w\:\.\']+\s+using\s+\'GUI\'\"
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: ''
  event-key-mapping:  
    '':
      annotate:
        Stream: CONFIGURATION
        Action: CONFIGURATION_CHANGED
        Status: PASSED
        Config: Management Operation
      translate:
        user_name: User      
    
  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System  

- first-match: 'log_id\=062009517504.*?message\=\"User\s+\S+\s+was\s+disconnected\s+by\s+\S+\s+from\s+[\w\:\.]+\s+using\s+GUI\"'
  decoder: custom
  decoder-regex: '([\w\-\.]+)\=(?:\"([^\"]+|)|([^\s]+|))'
  event-key-format: ''
  event-key-mapping:  
    '':
      annotate:
        Stream: AUTHENTICATION
        Action: LOGIN
        Status: FAILED
        Reason: User Disconnected from PPPOE Interface
      translate:
        USER: User   
        src_ip: SrcIP
        AuthProto: AuthProto   
    
  fallback:
    annotate:
      EventName: Generic Cyberoam Firewall Event
      Stream: OTHER

  globals:
    translate:
      date: SystemTstamp
      device_name: System